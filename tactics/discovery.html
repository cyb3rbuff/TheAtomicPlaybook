

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Discovery &#8212; The Atomic Playbook</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/mystnb.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="T1135 - Network Share Discovery" href="discovery/T1135.html" />
    <link rel="prev" title="T1528 - Steal Application Access Token" href="credential-access/T1528.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">The Atomic Playbook</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Welcome to the Atomic Playbook
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="initial-access.html">
   Initial Access
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="execution.html">
   Execution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="persistence.html">
   Persistence
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="privilege-escalation.html">
   Privilege Escalation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="defense-evasion.html">
   Defense Evasion
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="credential-access.html">
   Credential Access
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Discovery
  </a>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1135.html">
     T1135 - Network Share Discovery
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1135.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1049.html">
     T1049 - System Network Connections Discovery
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1049.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1033.html">
     T1033 - System Owner/User Discovery
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1033.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1087.002.html">
     T1087.002 - Account Discovery: Domain Account
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1526.html">
     T1526 - Cloud Service Discovery
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1526.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1497.002.html">
     T1497.002 - User Activity Based Checks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1087.004.html">
     T1087.004 - Cloud Account
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1069.002.html">
     T1069.002 - Permission Groups Discovery: Domain Groups
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1069.html">
     T1069 - Permission Groups Discovery
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1069.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1016.html">
     T1016 - System Network Configuration Discovery
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1016.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1482.html">
     T1482 - Domain Trust Discovery
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1482.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1087.003.html">
     T1087.003 - Email Account
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1518.html">
     T1518 - Software Discovery
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1518.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1087.001.html">
     T1087.001 - Account Discovery: Local Account
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1497.003.html">
     T1497.003 - Time Based Evasion
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1538.html">
     T1538 - Cloud Service Dashboard
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1538.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1010.html">
     T1010 - Application Window Discovery
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1010.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1069.003.html">
     T1069.003 - Cloud Groups
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1012.html">
     T1012 - Query Registry
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1012.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1057.html">
     T1057 - Process Discovery
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1057.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1069.001.html">
     T1069.001 - Permission Groups Discovery: Local Groups
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1217.html">
     T1217 - Browser Bookmark Discovery
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1217.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1497.001.html">
     T1497.001 - System Checks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1518.001.html">
     T1518.001 - Software Discovery: Security Software Discovery
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1082.html">
     T1082 - System Information Discovery
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1082.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1007.html">
     T1007 - System Service Discovery
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1007.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1040.html">
     T1040 - Network Sniffing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1040.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1018.html">
     T1018 - Remote System Discovery
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1018.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1046.html">
     T1046 - Network Service Scanning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1046.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1497.html">
     T1497 - Virtualization/Sandbox Evasion
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1497.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1201.html">
     T1201 - Password Policy Discovery
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1201.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1124.html">
     T1124 - System Time Discovery
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1124.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1083.html">
     T1083 - File and Directory Discovery
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1083.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1087.html">
     T1087 - Account Discovery
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1087.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1120.html">
     T1120 - Peripheral Device Discovery
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="discovery/T1120.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lateral-movement.html">
   Lateral Movement
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="collection.html">
   Collection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="command-and-control.html">
   Command and Control
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="exfiltration.html">
   Exfiltration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="impact.html">
   Impact
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/tactics/discovery.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#techniques">
   Techniques
  </a>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="discovery">
<h1>Discovery<a class="headerlink" href="#discovery" title="Permalink to this headline">¶</a></h1>
<p>The adversary is trying to figure out your environment.</p>
<p>Discovery consists of techniques an adversary may use to gain knowledge about the system and internal network. These techniques help adversaries observe the environment and orient themselves before deciding how to act. They also allow adversaries to explore what they can control and what’s around their entry point in order to discover how it could benefit their current objective. Native operating system tools are often used toward this post-compromise information-gathering objective.</p>
<div class="section" id="techniques">
<h2>Techniques<a class="headerlink" href="#techniques" title="Permalink to this headline">¶</a></h2>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>ID</p></th>
<th class="text-align:center head"><p>Name</p></th>
<th class="text-align:center head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>T1069.001</p></td>
<td class="text-align:center"><p>Local Groups</p></td>
<td class="text-align:center"><p>Adversaries may attempt to find local system groups and permission settings. The knowledge of local system permission groups can help adversaries determine which groups exist and which users belong to a particular group. Adversaries may use this information to determine which users have elevated permissions, such as the users found within the local administrators group.</p></td>
</tr>
</tbody>
</table>
<p>Commands such as <code>net localgroup</code> of the <a class="reference external" href="https://attack.mitre.org/software/S0039">Net</a> utility, <code>dscl . -list /Groups</code> on macOS, and <code>groups</code> on Linux can list local groups.
T1497.003 | Time Based Evasion | Adversaries may employ various time-based methods to detect and avoid virtualization and analysis environments. This may include timers or other triggers to avoid a virtual machine environment (VME) or sandbox, specifically those that are automated or only operate for a limited amount of time.</p>
<p>Adversaries may employ various time-based evasions, such as delaying malware functionality upon initial execution using programmatic sleep commands or native system scheduling functionality (ex: <a class="reference external" href="https://attack.mitre.org/techniques/T1053">Scheduled Task/Job</a>). Delays may also be based on waiting for specific victim conditions to be met (ex: system time, events, etc.) or employ scheduled <a class="reference external" href="https://attack.mitre.org/techniques/T1104">Multi-Stage Channels</a> to avoid analysis and scrutiny.
T1497.002 | User Activity Based Checks | Adversaries may employ various user activity checks to detect and avoid virtualization and analysis environments. This may include changing behaviors based on the results of checks for the presence of artifacts indicative of a virtual machine environment (VME) or sandbox. If the adversary detects a VME, they may alter their malware to disengage from the victim or conceal the core functions of the implant. They may also search for VME artifacts before dropping secondary or additional payloads. Adversaries may use the information learned from <a class="reference external" href="https://attack.mitre.org/techniques/T1497">Virtualization/Sandbox Evasion</a> during automated discovery to shape follow-on behaviors.</p>
<p>Adversaries may search for user activity on the host based on variables such as the speed/frequency of mouse movements and clicks (Citation: Sans Virtual Jan 2016) , browser history, cache, bookmarks, or number of files in common directories such as home or the desktop. Other methods may rely on specific user interaction with the system before the malicious code is activated, such as waiting for a document to close before activating a macro (Citation: Unit 42 Sofacy Nov 2018) or waiting for a user to double click on an embedded image to activate.(Citation: FireEye FIN7 April 2017)
T1497.001 | System Checks | Adversaries may employ various system checks to detect and avoid virtualization and analysis environments. This may include changing behaviors based on the results of checks for the presence of artifacts indicative of a virtual machine environment (VME) or sandbox. If the adversary detects a VME, they may alter their malware to disengage from the victim or conceal the core functions of the implant. They may also search for VME artifacts before dropping secondary or additional payloads. Adversaries may use the information learned from <a class="reference external" href="https://attack.mitre.org/techniques/T1497">Virtualization/Sandbox Evasion</a> during automated discovery to shape follow-on behaviors.</p>
<p>Specific checks may will vary based on the target and/or adversary, but may involve behaviors such as <a class="reference external" href="https://attack.mitre.org/techniques/T1047">Windows Management Instrumentation</a>, <a class="reference external" href="https://attack.mitre.org/techniques/T1059/001">PowerShell</a>, <a class="reference external" href="https://attack.mitre.org/techniques/T1082">System Information Discovery</a>, and <a class="reference external" href="https://attack.mitre.org/techniques/T1012">Query Registry</a> to obtain system information and search for VME artifacts. Adversaries may search for VME artifacts in memory, processes, file system, hardware, and/or the Registry. Adversaries may use scripting to automate these checks  into one script and then have the program exit if it determines the system to be a virtual environment.</p>
<p>Checks could include generic system properties such as uptime and samples of network traffic. Adversaries may also check the network adapters addresses, CPU core count, and available memory/drive size.</p>
<p>Other common checks may enumerate services running that are unique to these applications, installed programs on the system, manufacturer/product fields for strings relating to virtual machine applications, and VME-specific hardware/processor instructions.(Citation: McAfee Virtual Jan 2017) In applications like VMWare, adversaries can also use a special I/O port to send commands and receive output.</p>
<p>Hardware checks, such as the presence of the fan, temperature, and audio devices, could also be used to gather evidence that can be indicative a virtual environment. Adversaries may also query for specific readings from these devices.(Citation: Unit 42 OilRig Sept 2018)
T1518.001 | Security Software Discovery | Adversaries may attempt to get a listing of security software, configurations, defensive tools, and sensors that are installed on a system or in a cloud environment. This may include things such as firewall rules and anti-virus. Adversaries may use the information from <a class="reference external" href="https://attack.mitre.org/techniques/T1518/001">Security Software Discovery</a> during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.</p>
<p>Example commands that can be used to obtain security software information are <a class="reference external" href="https://attack.mitre.org/software/S0108">netsh</a>, <code>reg query</code> with <a class="reference external" href="https://attack.mitre.org/software/S0075">Reg</a>, <code>dir</code> with <a class="reference external" href="https://attack.mitre.org/software/S0106">cmd</a>, and <a class="reference external" href="https://attack.mitre.org/software/S0057">Tasklist</a>, but other indicators of discovery behavior may be more specific to the type of software or security system the adversary is looking for. It is becoming more common to see macOS malware perform checks for LittleSnitch and KnockKnock software.</p>
<p>Adversaries may also utilize cloud APIs to discover the configurations of firewall rules within an environment.(Citation: Expel IO Evil in AWS)
T1069.003 | Cloud Groups | Adversaries may attempt to find cloud groups and permission settings. The knowledge of cloud permission groups can help adversaries determine the particular roles of users and groups within an environment, as well as which users are associated with a particular group.</p>
<p>With authenticated access there are several tools that can be used to find permissions groups. The <code>Get-MsolRole</code> PowerShell cmdlet can be used to obtain roles and permissions groups for Exchange and Office 365 accounts.(Citation: Microsoft Msolrole)(Citation: GitHub Raindance)</p>
<p>Azure CLI (AZ CLI) also provides an interface to obtain permissions groups with authenticated access to a domain. The command <code>az ad user get-member-groups</code> will list groups associated to a user account.(Citation: Microsoft AZ CLI)(Citation: Black Hills Red Teaming MS AD Azure, 2018)
T1069.002 | Domain Groups | Adversaries may attempt to find domain-level groups and permission settings. The knowledge of domain-level permission groups can help adversaries determine which groups exist and which users belong to a particular group. Adversaries may use this information to determine which users have elevated permissions, such as domain administrators.</p>
<p>Commands such as <code>net group /domain</code> of the <a class="reference external" href="https://attack.mitre.org/software/S0039">Net</a> utility,  <code>dscacheutil -q group</code> on macOS, and <code>ldapsearch</code> on Linux can list domain-level groups.
T1087.004 | Cloud Account | Adversaries may attempt to get a listing of cloud accounts. Cloud accounts are those created and configured by an organization for use by users, remote support, services, or for administration of resources within a cloud service provider of SaaS application.</p>
<p>With authenticated access there are several tools that can be used to find accounts. The <code>Get-MsolRoleMember</code> PowerShell cmdlet can be used to obtain account names given a role or permissions group.(Citation: Microsoft msolrolemember)(Citation: GitHub Raindance)</p>
<p>Azure CLI (AZ CLI) also provides an interface to obtain user accounts with authenticated access to a domain. The command <code>az ad user list</code> will list all users within a domain.(Citation: Microsoft AZ CLI)(Citation: Black Hills Red Teaming MS AD Azure, 2018)
T1087.003 | Email Account | Adversaries may attempt to get a listing of email addresses and accounts. Adversaries may try to dump Exchange address lists such as global address lists (GALs).(Citation: Microsoft Exchange Address Lists)</p>
<p>In on-premises Exchange and Exchange Online, the<code>Get-GlobalAddressList</code> PowerShell cmdlet can be used to obtain email addresses and accounts from a domain using an authenticated session.(Citation: Microsoft getglobaladdresslist)(Citation: Black Hills Attacking Exchange MailSniper, 2016)
T1087.002 | Domain Account | Adversaries may attempt to get a listing of domain accounts. This information can help adversaries determine which domain accounts exist to aid in follow-on behavior.</p>
<p>Commands such as <code>net user /domain</code> and <code>net group /domain</code> of the <a class="reference external" href="https://attack.mitre.org/software/S0039">Net</a> utility, <code>dscacheutil -q group</code>on macOS, and <code>ldapsearch</code> on Linux can list domain users and groups.
T1087.001 | Local Account | Adversaries may attempt to get a listing of local system accounts. This information can help adversaries determine which local accounts exist on a system to aid in follow-on behavior.</p>
<p>Commands such as <code>net user</code> and <code>net localgroup</code> of the <a class="reference external" href="https://attack.mitre.org/software/S0039">Net</a> utility and <code>id</code> and <code>groups</code>on macOS and Linux can list local users and groups. On Linux, local users can also be enumerated through the use of the <code>/etc/passwd</code> file.
T1518 | Software Discovery | Adversaries may attempt to get a listing of software and software versions that are installed on a system or in a cloud environment. Adversaries may use the information from <a class="reference external" href="https://attack.mitre.org/techniques/T1518">Software Discovery</a> during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.</p>
<p>Adversaries may attempt to enumerate software for a variety of reasons, such as figuring out what security measures are present or if the compromised system has a version of software that is vulnerable to <a class="reference external" href="https://attack.mitre.org/techniques/T1068">Exploitation for Privilege Escalation</a>.
T1538 | Cloud Service Dashboard | An adversary may use a cloud service dashboard GUI with stolen credentials to gain useful information from an operational cloud environment, such as specific services, resources, and features. For example, the GCP Command Center can be used to view all assets, findings of potential security risks, and to run additional queries, such as finding public IP addresses and open ports.(Citation: Google Command Center Dashboard)</p>
<p>Depending on the configuration of the environment, an adversary may be able to enumerate more information via the graphical dashboard than an API. This allows the adversary to gain information without making any API requests.
T1526 | Cloud Service Discovery | An adversary may attempt to enumerate the cloud services running on a system after gaining access. These methods can differ from platform-as-a-service (PaaS), to infrastructure-as-a-service (IaaS), or software-as-a-service (SaaS). Many services exist throughout the various cloud providers and can include Continuous Integration and Continuous Delivery (CI/CD), Lambda Functions, Azure AD, etc.</p>
<p>Adversaries may attempt to discover information about the services enabled throughout the environment. Azure tools and APIs, such as the Azure AD Graph API and Azure Resource Manager API, can enumerate resources and services, including applications, management groups, resources and policy definitions, and their relationships that are accessible by an identity.(Citation: Azure - Resource Manager API)(Citation: Azure AD Graph API)</p>
<p>Stormspotter is an open source tool for enumerating and constructing a graph for Azure resources and services, and Pacu is an open source AWS exploitation framework that supports several methods for discovering cloud services.(Citation: Azure - Stormspotter)(Citation: GitHub Pacu)
T1497 | Virtualization/Sandbox Evasion | Adversaries may employ various means to detect and avoid virtualization and analysis environments. This may include changing behaviors based on the results of checks for the presence of artifacts indicative of a virtual machine environment (VME) or sandbox. If the adversary detects a VME, they may alter their malware to disengage from the victim or conceal the core functions of the implant. They may also search for VME artifacts before dropping secondary or additional payloads. Adversaries may use the information learned from <a class="reference external" href="https://attack.mitre.org/techniques/T1497">Virtualization/Sandbox Evasion</a> during automated discovery to shape follow-on behaviors.</p>
<p>Adversaries may use several methods to accomplish <a class="reference external" href="https://attack.mitre.org/techniques/T1497">Virtualization/Sandbox Evasion</a> such as checking for security monitoring tools (e.g., Sysinternals, Wireshark, etc.) or other system artifacts associated with analysis or virtualization. Adversaries may also check for legitimate user activity to help determine if it is in an analysis environment. Additional methods include use of sleep timers or loops within malware code to avoid operating within a temporary sandbox.(Citation: Unit 42 Pirpi July 2015)</p>
<p>T1482 | Domain Trust Discovery | Adversaries may attempt to gather information on domain trust relationships that may be used to identify lateral movement opportunities in Windows multi-domain/forest environments. Domain trusts provide a mechanism for a domain to allow access to resources based on the authentication procedures of another domain.(Citation: Microsoft Trusts) Domain trusts allow the users of the trusted domain to access resources in the trusting domain. The information discovered may help the adversary conduct <a class="reference external" href="https://attack.mitre.org/techniques/T1134/005">SID-History Injection</a>, <a class="reference external" href="https://attack.mitre.org/techniques/T1550/003">Pass the Ticket</a>, and <a class="reference external" href="https://attack.mitre.org/techniques/T1558/003">Kerberoasting</a>.(Citation: AdSecurity Forging Trust Tickets)(Citation: Harmj0y Domain Trusts) Domain trusts can be enumerated using the <code class="docutils literal notranslate"><span class="pre">DSEnumerateDomainTrusts()</span></code> Win32 API call, .NET methods, and LDAP.(Citation: Harmj0y Domain Trusts) The Windows utility <a class="reference external" href="https://attack.mitre.org/software/S0359">Nltest</a> is known to be used by adversaries to enumerate domain trusts.(Citation: Microsoft Operation Wilysupply)
T1217 | Browser Bookmark Discovery | Adversaries may enumerate browser bookmarks to learn more about compromised hosts. Browser bookmarks may reveal personal information about users (ex: banking sites, interests, social media, etc.) as well as details about internal network resources such as servers, tools/dashboards, or other related infrastructure.</p>
<p>Browser bookmarks may also highlight additional targets after an adversary has access to valid credentials, especially <a class="reference external" href="https://attack.mitre.org/techniques/T1552/001">Credentials In Files</a> associated with logins cached by a browser.</p>
<p>Specific storage locations vary based on platform and/or application, but browser bookmarks are typically stored in local files/databases.
T1201 | Password Policy Discovery | Adversaries may attempt to access detailed information about the password policy used within an enterprise network. Password policies for networks are a way to enforce complex passwords that are difficult to guess or crack through <a class="reference external" href="https://attack.mitre.org/techniques/T1110">Brute Force</a>. This would help the adversary to create a list of common passwords and launch dictionary and/or brute force attacks which adheres to the policy (e.g. if the minimum password length should be 8, then not trying passwords such as ‘pass123’; not checking for more than 3-4 passwords per account if the lockout is set to 6 as to not lock out accounts).</p>
<p>Password policies can be set and discovered on Windows, Linux, and macOS systems via various command shell utilities such as <code>net accounts (/domain)</code>, <code>chage -l <username></code>, <code>cat /etc/pam.d/common-password</code>, and <code>pwpolicy getaccountpolicies</code>.(Citation: Superuser Linux Password Policies) (Citation: Jamf User Password Policies)
T1135 | Network Share Discovery | Adversaries may look for folders and drives shared on remote systems as a means of identifying sources of information to gather as a precursor for Collection and to identify potential systems of interest for Lateral Movement. Networks often contain shared network drives and folders that enable users to access file directories on various systems across a network.</p>
<p>File sharing over a Windows network occurs over the SMB protocol. (Citation: Wikipedia Shared Resource) (Citation: TechNet Shared Folder) <a class="reference external" href="https://attack.mitre.org/software/S0039">Net</a> can be used to query a remote system for available shared drives using the <code>net view \remotesystem</code> command. It can also be used to query shared drives on the local system using <code>net share</code>.</p>
<p>Cloud virtual networks may contain remote network shares or file storage services accessible to an adversary after they have obtained access to a system. For example, AWS, GCP, and Azure support creation of Network File System (NFS) shares and Server Message Block (SMB) shares that may be mapped on endpoint or cloud-based systems.(Citation: Amazon Creating an NFS File Share)(Citation: Google File servers on Compute Engine)
T1124 | System Time Discovery | An adversary may gather the system time and/or time zone from a local or remote system. The system time is set and stored by the Windows Time Service within a domain to maintain time synchronization between systems and services in an enterprise network. (Citation: MSDN System Time) (Citation: Technet Windows Time Service)</p>
<p>System time information may be gathered in a number of ways, such as with <a class="reference external" href="https://attack.mitre.org/software/S0039">Net</a> on Windows by performing <code>net time \hostname</code> to gather the system time on a remote system. The victim’s time zone may also be inferred from the current system time or gathered by using <code>w32tm /tz</code>. (Citation: Technet Windows Time Service) The information could be useful for performing other techniques, such as executing a file with a <a class="reference external" href="https://attack.mitre.org/techniques/T1053">Scheduled Task/Job</a> (Citation: RSA EU12 They’re Inside), or to discover locality information based on time zone to assist in victim targeting.
T1120 | Peripheral Device Discovery | Adversaries may attempt to gather information about attached peripheral devices and components connected to a computer system. Peripheral devices could include auxiliary resources that support a variety of functionalities such as keyboards, printers, cameras, smart card readers, or removable storage. The information may be used to enhance their awareness of the system and network environment or may be used for further actions.
T1087 | Account Discovery | Adversaries may attempt to get a listing of accounts on a system or within an environment. This information can help adversaries determine which accounts exist to aid in follow-on behavior.
T1083 | File and Directory Discovery | Adversaries may enumerate files and directories or may search in specific locations of a host or network share for certain information within a file system. Adversaries may use the information from <a class="reference external" href="https://attack.mitre.org/techniques/T1083">File and Directory Discovery</a> during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.</p>
<p>Many command shell utilities can be used to obtain this information. Examples include <code>dir</code>, <code>tree</code>, <code>ls</code>, <code>find</code>, and <code>locate</code>. (Citation: Windows Commands JPCERT) Custom tools may also be used to gather file and directory information and interact with the <a class="reference external" href="https://attack.mitre.org/techniques/T1106">Native API</a>.
T1082 | System Information Discovery | An adversary may attempt to get detailed information about the operating system and hardware, including version, patches, hotfixes, service packs, and architecture. Adversaries may use the information from <a class="reference external" href="https://attack.mitre.org/techniques/T1082">System Information Discovery</a> during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.</p>
<p>Tools such as <a class="reference external" href="https://attack.mitre.org/software/S0096">Systeminfo</a> can be used to gather detailed system information. A breakdown of system data can also be gathered through the macOS <code>systemsetup</code> command, but it requires administrative privileges.</p>
<p>Infrastructure as a Service (IaaS) cloud providers such as AWS, GCP, and Azure allow access to instance and virtual machine information via APIs. Successful authenticated API calls can return data such as the operating system platform and status of a particular instance or the model view of a virtual machine.(Citation: Amazon Describe Instance)(Citation: Google Instances Resource)(Citation: Microsoft Virutal Machine API)
T1069 | Permission Groups Discovery | Adversaries may attempt to find group and permission settings. This information can help adversaries determine which user accounts and groups are available, the membership of users in particular groups, and which users and groups have elevated permissions.
T1057 | Process Discovery | Adversaries may attempt to get information about running processes on a system. Information obtained could be used to gain an understanding of common software/applications running on systems within the network. Adversaries may use the information from <a class="reference external" href="https://attack.mitre.org/techniques/T1057">Process Discovery</a> during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.</p>
<p>In Windows environments, adversaries could obtain details on running processes using the <a class="reference external" href="https://attack.mitre.org/software/S0057">Tasklist</a> utility via <a class="reference external" href="https://attack.mitre.org/software/S0106">cmd</a> or <code>Get-Process</code> via <a class="reference external" href="https://attack.mitre.org/techniques/T1059/001">PowerShell</a>. Information about processes can also be extracted from the output of <a class="reference external" href="https://attack.mitre.org/techniques/T1106">Native API</a> calls such as <code>CreateToolhelp32Snapshot</code>. In Mac and Linux, this is accomplished with the <code>ps</code> command. Adversaries may also opt to enumerate processes via /proc.
T1049 | System Network Connections Discovery | Adversaries may attempt to get a listing of network connections to or from the compromised system they are currently accessing or from remote systems by querying for information over the network.</p>
<p>An adversary who gains access to a system that is part of a cloud-based environment may map out Virtual Private Clouds or Virtual Networks in order to determine what systems and services are connected. The actions performed are likely the same types of discovery techniques depending on the operating system, but the resulting information may include details about the networked cloud environment relevant to the adversary’s goals. Cloud providers may have different ways in which their virtual networks operate.(Citation: Amazon AWS VPC Guide)(Citation: Microsoft Azure Virtual Network Overview)(Citation: Google VPC Overview)</p>
<p>Utilities and commands that acquire this information include <a class="reference external" href="https://attack.mitre.org/software/S0104">netstat</a>, “net use,” and “net session” with <a class="reference external" href="https://attack.mitre.org/software/S0039">Net</a>. In Mac and Linux, <a class="reference external" href="https://attack.mitre.org/software/S0104">netstat</a> and <code>lsof</code> can be used to list current connections. <code>who -a</code> and <code>w</code> can be used to show which users are currently logged in, similar to “net session”.
T1046 | Network Service Scanning | Adversaries may attempt to get a listing of services running on remote hosts, including those that may be vulnerable to remote software exploitation. Methods to acquire this information include port scans and vulnerability scans using tools that are brought onto a system.</p>
<p>Within cloud environments, adversaries may attempt to discover services running on other cloud hosts. Additionally, if the cloud environment is connected to a on-premises environment, adversaries may be able to identify services running on non-cloud systems as well.
T1040 | Network Sniffing | Adversaries may sniff network traffic to capture information about an environment, including authentication material passed over the network. Network sniffing refers to using the network interface on a system to monitor or capture information sent over a wired or wireless connection. An adversary may place a network interface into promiscuous mode to passively access data in transit over the network, or use span ports to capture a larger amount of data.</p>
<p>Data captured via this technique may include user credentials, especially those sent over an insecure, unencrypted protocol. Techniques for name service resolution poisoning, such as <a class="reference external" href="https://attack.mitre.org/techniques/T1557/001">LLMNR/NBT-NS Poisoning and SMB Relay</a>, can also be used to capture credentials to websites, proxies, and internal systems by redirecting traffic to an adversary.</p>
<p>Network sniffing may also reveal configuration details, such as running services, version numbers, and other network characteristics (e.g. IP addresses, hostnames, VLAN IDs) necessary for subsequent Lateral Movement and/or Defense Evasion activities.
T1033 | System Owner/User Discovery | Adversaries may attempt to identify the primary user, currently logged in user, set of users that commonly uses a system, or whether a user is actively using the system. They may do this, for example, by retrieving account usernames or by using <a class="reference external" href="https://attack.mitre.org/techniques/T1003">OS Credential Dumping</a>. The information may be collected in a number of different ways using other Discovery techniques, because user and username details are prevalent throughout a system and include running process ownership, file/directory ownership, session information, and system logs. Adversaries may use the information from <a class="reference external" href="https://attack.mitre.org/techniques/T1033">System Owner/User Discovery</a> during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.</p>
<p>Utilities and commands that acquire this information include <code>whoami</code>. In Mac and Linux, the currently logged in user can be identified with <code>w</code> and <code>who</code>.
T1018 | Remote System Discovery | Adversaries may attempt to get a listing of other systems by IP address, hostname, or other logical identifier on a network that may be used for Lateral Movement from the current system. Functionality could exist within remote access tools to enable this, but utilities available on the operating system could also be used such as  <a class="reference external" href="https://attack.mitre.org/software/S0097">Ping</a> or <code>net view</code> using <a class="reference external" href="https://attack.mitre.org/software/S0039">Net</a>. Adversaries may also use local host files (ex: <code>C:\Windows\System32\Drivers\etc\hosts</code> or <code>/etc/hosts</code>) in order to discover the hostname to IP address mappings of remote systems.</p>
<p>Specific to macOS, the <code>bonjour</code> protocol exists to discover additional Mac-based systems within the same broadcast domain.</p>
<p>Within IaaS (Infrastructure as a Service) environments, remote systems include instances and virtual machines in various states, including the running or stopped state. Cloud providers have created methods to serve information about remote systems, such as APIs and CLIs. For example, AWS provides a <code>DescribeInstances</code> API within the Amazon EC2 API and a <code>describe-instances</code> command within the AWS CLI that can return information about all instances within an account.(Citation: Amazon Describe Instances API)(Citation: Amazon Describe Instances CLI) Similarly, GCP’s Cloud SDK CLI provides the <code>gcloud compute instances list</code> command to list all Google Compute Engine instances in a project, and Azure’s CLI <code>az vm list</code> lists details of virtual machines.(Citation: Google Compute Instances)(Citation: Azure VM List)
T1016 | System Network Configuration Discovery | Adversaries may look for details about the network configuration and settings of systems they access or through information discovery of remote systems. Several operating system administration utilities exist that can be used to gather this information. Examples include <a class="reference external" href="https://attack.mitre.org/software/S0099">Arp</a>, <a class="reference external" href="https://attack.mitre.org/software/S0100">ipconfig</a>/<a class="reference external" href="https://attack.mitre.org/software/S0101">ifconfig</a>, <a class="reference external" href="https://attack.mitre.org/software/S0102">nbtstat</a>, and <a class="reference external" href="https://attack.mitre.org/software/S0103">route</a>.</p>
<p>Adversaries may use the information from <a class="reference external" href="https://attack.mitre.org/techniques/T1016">System Network Configuration Discovery</a> during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.
T1012 | Query Registry | Adversaries may interact with the Windows Registry to gather information about the system, configuration, and installed software.</p>
<p>The Registry contains a significant amount of information about the operating system, configuration, software, and security.(Citation: Wikipedia Windows Registry) Information can easily be queried using the <a class="reference external" href="https://attack.mitre.org/software/S0075">Reg</a> utility, though other means to access the Registry exist. Some of the information may help adversaries to further their operation within a network. Adversaries may use the information from <a class="reference external" href="https://attack.mitre.org/techniques/T1012">Query Registry</a> during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.
T1010 | Application Window Discovery | Adversaries may attempt to get a listing of open application windows. Window listings could convey information about how the system is used or give context to information collected by a keylogger.
T1007 | System Service Discovery | Adversaries may try to get information about registered services. Commands that may obtain information about services using operating system utilities are “sc,” “tasklist /svc” using <a class="reference external" href="https://attack.mitre.org/software/S0057">Tasklist</a>, and “net start” using <a class="reference external" href="https://attack.mitre.org/software/S0039">Net</a>, but adversaries may also use other tools as well. Adversaries may use the information from <a class="reference external" href="https://attack.mitre.org/techniques/T1007">System Service Discovery</a> during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#Invoke-AtomicTest-By can be downloaded from https://github.com/haresudhan/ART-Utils/tree/master/Invoke-AtomicTest-By</span>
<span class="n">Invoke</span><span class="o">-</span><span class="n">AtomicTest</span><span class="o">-</span><span class="n">By</span> <span class="o">-</span><span class="n">Tactic</span> <span class="n">discovery</span>
</pre></div>
</div>
</div>
</div>
<div class="toctree-wrapper compound">
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: ".net-powershell"
        },
        kernelOptions: {
            kernelName: ".net-powershell",
            path: "./tactics"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = '.net-powershell'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="credential-access/T1528.html" title="previous page">T1528 - Steal Application Access Token</a>
    <a class='right-next' id="next-link" href="discovery/T1135.html" title="next page">T1135 - Network Share Discovery</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Hare Sudhan Muthusamy<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    
  </body>
</html>