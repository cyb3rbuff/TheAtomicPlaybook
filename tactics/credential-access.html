

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Credential Access &#8212; The Atomic Playbook</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/mystnb.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="T1056.001 - Input Capture: Keylogging" href="credential-access/T1056.001.html" />
    <link rel="prev" title="T1205 - Traffic Signaling" href="defense-evasion/T1205.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">The Atomic Playbook</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Welcome to the Atomic Playbook
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="initial-access.html">
   Initial Access
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="execution.html">
   Execution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="persistence.html">
   Persistence
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="privilege-escalation.html">
   Privilege Escalation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="defense-evasion.html">
   Defense Evasion
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Credential Access
  </a>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1056.001.html">
     T1056.001 - Input Capture: Keylogging
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1110.001.html">
     T1110.001 - Brute Force: Password Guessing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1111.html">
     T1111 - Two-Factor Authentication Interception
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1212.html">
     T1212 - Exploitation for Credential Access
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1110.003.html">
     T1110.003 - Brute Force: Password Spraying
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1056.003.html">
     T1056.003 - Web Portal Capture
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1056.html">
     T1056 - Input Capture
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1556.003.html">
     T1556.003 - Pluggable Authentication Modules
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1556.001.html">
     T1556.001 - Domain Controller Authentication
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1539.html">
     T1539 - Steal Web Session Cookie
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1558.html">
     T1558 - Steal or Forge Kerberos Tickets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1003.008.html">
     T1003.008 - /etc/passwd and /etc/shadow
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1110.002.html">
     T1110.002 - Password Cracking
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1056.002.html">
     T1056.002 - Input Capture: GUI Input Capture
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1110.html">
     T1110 - Brute Force
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1056.004.html">
     T1056.004 - Input Capture: Credential API Hooking
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1110.004.html">
     T1110.004 - Credential Stuffing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1557.001.html">
     T1557.001 - LLMNR/NBT-NS Poisoning and SMB Relay
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1556.002.html">
     T1556.002 - Modify Authentication Process: Password Filter DLL
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1557.html">
     T1557 - Man-in-the-Middle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1552.003.html">
     T1552.003 - Unsecured Credentials: Bash History
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1552.001.html">
     T1552.001 - Unsecured Credentials: Credentials In Files
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1555.html">
     T1555 - Credentials from Password Stores
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1040.html">
     T1040 - Network Sniffing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1003.002.html">
     T1003.002 - OS Credential Dumping: Security Account Manager
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1558.002.html">
     T1558.002 - Silver Ticket
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1003.006.html">
     T1003.006 - DCSync
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1552.005.html">
     T1552.005 - Cloud Instance Metadata API
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1555.002.html">
     T1555.002 - Securityd Memory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1003.004.html">
     T1003.004 - OS Credential Dumping: LSA Secrets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1003.html">
     T1003 - OS Credential Dumping
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1003.003.html">
     T1003.003 - OS Credential Dumping: NTDS
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1003.001.html">
     T1003.001 - OS Credential Dumping: LSASS Memory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1552.002.html">
     T1552.002 - Unsecured Credentials: Credentials in Registry
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1187.html">
     T1187 - Forced Authentication
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1556.html">
     T1556 - Modify Authentication Process
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1552.006.html">
     T1552.006 - Unsecured Credentials: Group Policy Preferences
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1555.003.html">
     T1555.003 - Credentials from Password Stores: Credentials from Web Browsers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1552.html">
     T1552 - Unsecured Credentials
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1003.005.html">
     T1003.005 - Cached Domain Credentials
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1558.001.html">
     T1558.001 - Golden Ticket
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1003.007.html">
     T1003.007 - Proc Filesystem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1558.003.html">
     T1558.003 - Steal or Forge Kerberos Tickets: Kerberoasting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1552.004.html">
     T1552.004 - Unsecured Credentials: Private Keys
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1555.001.html">
     T1555.001 - Credentials from Password Stores: Keychain
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="credential-access/T1528.html">
     T1528 - Steal Application Access Token
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="discovery.html">
   Discovery
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lateral-movement.html">
   Lateral Movement
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="collection.html">
   Collection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="command-and-control.html">
   Command and Control
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="exfiltration.html">
   Exfiltration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="impact.html">
   Impact
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/tactics/credential-access.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#techniques">
   Techniques
  </a>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="credential-access">
<h1>Credential Access<a class="headerlink" href="#credential-access" title="Permalink to this headline">¶</a></h1>
<p>The adversary is trying to steal account names and passwords.</p>
<p>Credential Access consists of techniques for stealing credentials like account names and passwords. Techniques used to get credentials include keylogging or credential dumping. Using legitimate credentials can give adversaries access to systems, make them harder to detect, and provide the opportunity to create more accounts to help achieve their goals.</p>
<div class="section" id="techniques">
<h2>Techniques<a class="headerlink" href="#techniques" title="Permalink to this headline">¶</a></h2>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>ID</p></th>
<th class="text-align:center head"><p>Name</p></th>
<th class="text-align:center head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>T1556.003</p></td>
<td class="text-align:center"><p>Pluggable Authentication Modules</p></td>
<td class="text-align:center"><p>Adversaries may modify pluggable authentication modules (PAM) to access user credentials or enable otherwise unwarranted access to accounts. PAM is a modular system of configuration files, libraries, and executable files which guide authentication for many services. The most common authentication module is <code>pam_unix.so</code>, which retrieves, sets, and verifies account authentication information in <code>/etc/passwd</code> and <code>/etc/shadow</code>.(Citation: Apple PAM)(Citation: Man Pam_Unix)(Citation: Red Hat PAM)</p></td>
</tr>
</tbody>
</table>
<p>Adversaries may modify components of the PAM system to create backdoors. PAM components, such as <code>pam_unix.so</code>, can be patched to accept arbitrary adversary supplied values as legitimate credentials.(Citation: PAM Backdoor)</p>
<p>Malicious modifications to the PAM system may also be abused to steal credentials. Adversaries may infect PAM resources with code to harvest user credentials, since the values exchanged with PAM components may be plain-text since PAM does not store passwords.(Citation: PAM Creds)(Citation: Apple PAM)
T1003.004 | LSA Secrets | Adversaries with SYSTEM access to a host may attempt to access Local Security Authority (LSA) secrets, which can contain a variety of different credential materials, such as credentials for service accounts.(Citation: Passcape LSA Secrets)(Citation: Microsoft AD Admin Tier Model)(Citation: Tilbury Windows Credentials) LSA secrets are stored in the registry at <code>HKEY_LOCAL_MACHINE\SECURITY\Policy\Secrets</code>. LSA secrets can also be dumped from memory.(Citation: ired Dumping LSA Secrets)</p>
<p><a class="reference external" href="https://attack.mitre.org/software/S0075">Reg</a> can be used to extract from the Registry. <a class="reference external" href="https://attack.mitre.org/software/S0002">Mimikatz</a> can be used to extract secrets from memory.(Citation: ired Dumping LSA Secrets)
T1003.005 | Cached Domain Credentials | Adversaries may attempt to access cached domain credentials used to allow authentication to occur in the event a domain controller is unavailable.(Citation: Microsoft - Cached Creds)</p>
<p>On Windows Vista and newer, the hash format is DCC2 (Domain Cached Credentials version 2) hash, also known as MS-Cache v2 hash.(Citation: PassLib mscache) The number of default cached credentials varies and can be altered per system. This hash does not allow pass-the-hash style attacks, and instead requires <a class="reference external" href="https://attack.mitre.org/techniques/T1110/002">Password Cracking</a> to recover the plaintext password.(Citation: ired mscache)</p>
<p>With SYSTEM access, the tools/utilities such as <a class="reference external" href="https://attack.mitre.org/software/S0002">Mimikatz</a>, <a class="reference external" href="https://attack.mitre.org/software/S0075">Reg</a>, and secretsdump.py can be used to extract the cached credentials.</p>
<p>Note: Cached credentials for Windows Vista are derived using PBKDF2.(Citation: PassLib mscache)
T1555.003 | Credentials from Web Browsers | Adversaries may acquire credentials from web browsers by reading files specific to the target browser.(Citation: Talos Olympic Destroyer 2018) Web browsers commonly save credentials such as website usernames and passwords so that they do not need to be entered manually in the future. Web browsers typically store the credentials in an encrypted format within a credential store; however, methods exist to extract plaintext credentials from web browsers.</p>
<p>For example, on Windows systems, encrypted credentials may be obtained from Google Chrome by reading a database file, <code>AppData\Local\Google\Chrome\User Data\Default\Login Data</code> and executing a SQL query: <code>SELECT action_url, username_value, password_value FROM logins;</code>. The plaintext password can then be obtained by passing the encrypted credentials to the Windows API function <code>CryptUnprotectData</code>, which uses the victim’s cached logon credentials as the decryption key. (Citation: Microsoft CryptUnprotectData ‎April 2018)</p>
<p>Adversaries have executed similar procedures for common web browsers such as FireFox, Safari, Edge, etc. (Citation: Proofpoint Vega Credential Stealer May 2018)(Citation: FireEye HawkEye Malware July 2017)</p>
<p>Adversaries may also acquire credentials by searching web browser process memory for patterns that commonly match credentials.(Citation: GitHub Mimikittenz July 2016)</p>
<p>After acquiring credentials from web browsers, adversaries may attempt to recycle the credentials across different systems and/or accounts in order to expand access. This can result in significantly furthering an adversary’s objective in cases where credentials gained from web browsers overlap with privileged accounts (e.g. domain administrator).
T1555.002 | Securityd Memory | An adversary may obtain root access (allowing them to read securityd’s memory), then they can scan through memory to find the correct sequence of keys in relatively few tries to decrypt the user’s logon keychain. This provides the adversary with all the plaintext passwords for users, WiFi, mail, browsers, certificates, secure notes, etc.(Citation: OS X Keychain) (Citation: OSX Keydnap malware)</p>
<p>In OS X prior to El Capitan, users with root access can read plaintext keychain passwords of logged-in users because Apple’s keychain implementation allows these credentials to be cached so that users are not repeatedly prompted for passwords. (Citation: OS X Keychain) (Citation: External to DA, the OS X Way) Apple’s securityd utility takes the user’s logon password, encrypts it with PBKDF2, and stores this master key in memory. Apple also uses a set of keys and algorithms to encrypt the user’s password, but once the master key is found, an attacker need only iterate over the other values to unlock the final password.(Citation: OS X Keychain)
T1555.001 | Keychain | Adversaries may collect the keychain storage data from a system to acquire credentials. Keychains are the built-in way for macOS to keep track of users’ passwords and credentials for many services and features such as WiFi passwords, websites, secure notes, certificates, and Kerberos. Keychain files are located in <code>~/Library/Keychains/</code>,<code>/Library/Keychains/</code>, and <code>/Network/Library/Keychains/</code>. (Citation: Wikipedia keychain) The <code>security</code> command-line utility, which is built into macOS by default, provides a useful way to manage these credentials.</p>
<p>To manage their credentials, users have to use additional credentials to access their keychain. If an adversary knows the credentials for the login keychain, then they can get access to all the other credentials stored in this vault. (Citation: External to DA, the OS X Way) By default, the passphrase for the keychain is the user’s logon credentials.
T1558.002 | Silver Ticket | Adversaries who have the password hash of a target service account (e.g. SharePoint, MSSQL) may forge Kerberos ticket granting service (TGS) tickets, also known as silver tickets. Kerberos TGS tickets are also known as service tickets.(Citation: ADSecurity Silver Tickets)</p>
<p>Silver tickets are more limited in scope in than golden tickets in that they only enable adversaries to access a particular resource (e.g. MSSQL) and the system that hosts the resource; however, unlike golden tickets, adversaries with the ability to forge silver tickets are able to create TGS tickets without interacting with the Key Distribution Center (KDC), potentially making detection more difficult.(Citation: ADSecurity Detecting Forged Tickets)</p>
<p>Password hashes for target services may be obtained using <a class="reference external" href="https://attack.mitre.org/techniques/T1003">OS Credential Dumping</a> or <a class="reference external" href="https://attack.mitre.org/techniques/T1558/003">Kerberoasting</a>.
T1558.001 | Golden Ticket | Adversaries who have the KRBTGT account password hash may forge Kerberos ticket-granting tickets (TGT), also known as a golden ticket.(Citation: AdSecurity Kerberos GT Aug 2015) Golden tickets enable adversaries to generate authentication material for any account in Active Directory.(Citation: CERT-EU Golden Ticket Protection)</p>
<p>Using a golden ticket, adversaries are then able to request ticket granting service (TGS) tickets, which enable access to specific resources. Golden tickets require adversaries to interact with the Key Distribution Center (KDC) in order to obtain TGS.(Citation: ADSecurity Detecting Forged Tickets)</p>
<p>The KDC service runs all on domain controllers that are part of an Active Directory domain. KRBTGT is the Kerberos Key Distribution Center (KDC) service account and is responsible for encrypting and signing all Kerberos tickets.(Citation: ADSecurity Kerberos and KRBTGT) The KRBTGT password hash may be obtained using <a class="reference external" href="https://attack.mitre.org/techniques/T1003">OS Credential Dumping</a> and privileged access to a domain controller.
T1558 | Steal or Forge Kerberos Tickets | Adversaries may attempt to subvert Kerberos authentication by stealing or forging Kerberos tickets to enable <a class="reference external" href="https://attack.mitre.org/techniques/T1550/003">Pass the Ticket</a>.</p>
<p>Kerberos is an authentication protocol widely used in modern Windows domain environments. In Kerberos environments, referred to as “realms”, there are three basic participants: client, service, and Key Distribution Center (KDC).(Citation: ADSecurity Kerberos Ring Decoder) Clients request access to a service and through the exchange of Kerberos tickets, originating from KDC, they are granted access after having successfully authenticated. The KDC is responsible for both authentication and ticket granting.  Attackers may attempt to abuse Kerberos by stealing tickets or forging tickets to enable unauthorized access.
T1557.001 | LLMNR/NBT-NS Poisoning and SMB Relay | By responding to LLMNR/NBT-NS network traffic, adversaries may spoof an authoritative source for name resolution to force communication with an adversary controlled system. This activity may be used to collect or relay authentication materials.</p>
<p>Link-Local Multicast Name Resolution (LLMNR) and NetBIOS Name Service (NBT-NS) are Microsoft Windows components that serve as alternate methods of host identification. LLMNR is based upon the Domain Name System (DNS) format and allows hosts on the same local link to perform name resolution for other hosts. NBT-NS identifies systems on a local network by their NetBIOS name. (Citation: Wikipedia LLMNR) (Citation: TechNet NetBIOS)</p>
<p>Adversaries can spoof an authoritative source for name resolution on a victim network by responding to LLMNR (UDP 5355)/NBT-NS (UDP 137) traffic as if they know the identity of the requested host, effectively poisoning the service so that the victims will communicate with the adversary controlled system. If the requested host belongs to a resource that requires identification/authentication, the username and NTLMv2 hash will then be sent to the adversary controlled system. The adversary can then collect the hash information sent over the wire through tools that monitor the ports for traffic or through <a class="reference external" href="https://attack.mitre.org/techniques/T1040">Network Sniffing</a> and crack the hashes offline through <a class="reference external" href="https://attack.mitre.org/techniques/T1110">Brute Force</a> to obtain the plaintext passwords. In some cases where an adversary has access to a system that is in the authentication path between systems or when automated scans that use credentials attempt to authenticate to an adversary controlled system, the NTLMv2 hashes can be intercepted and relayed to access and execute code against a target system. The relay step can happen in conjunction with poisoning but may also be independent of it. (Citation: byt3bl33d3r NTLM Relaying)(Citation: Secure Ideas SMB Relay)</p>
<p>Several tools exist that can be used to poison name services within local networks such as NBNSpoof, Metasploit, and <a class="reference external" href="https://attack.mitre.org/software/S0174">Responder</a>. (Citation: GitHub NBNSpoof) (Citation: Rapid7 LLMNR Spoofer) (Citation: GitHub Responder)
T1557 | Man-in-the-Middle | Adversaries may attempt to position themselves between two or more networked devices using a man-in-the-middle (MiTM) technique to support follow-on behaviors such as <a class="reference external" href="https://attack.mitre.org/techniques/T1040">Network Sniffing</a> or <a class="reference external" href="https://attack.mitre.org/techniques/T1565/002">Transmitted Data Manipulation</a>. By abusing features of common networking protocols that can determine the flow of network traffic (e.g. ARP, DNS, LLMNR, etc.), adversaries may force a device to communicate through an adversary controlled system so they can collect information or perform additional actions.(Citation: Rapid7 MiTM Basics)</p>
<p>Adversaries may leverage the MiTM position to attempt to modify traffic, such as in <a class="reference external" href="https://attack.mitre.org/techniques/T1565/002">Transmitted Data Manipulation</a>. Adversaries can also stop traffic from flowing to the appropriate destination, causing denial of service.
T1556.002 | Password Filter DLL | Adversaries may register malicious password filter dynamic link libraries (DLLs) into the authentication process to acquire user credentials as they are validated.</p>
<p>Windows password filters are password policy enforcement mechanisms for both domain and local accounts. Filters are implemented as DLLs containing a method to validate potential passwords against password policies. Filter DLLs can be positioned on local computers for local accounts and/or domain controllers for domain accounts. Before registering new passwords in the Security Accounts Manager (SAM), the Local Security Authority (LSA) requests validation from each registered filter. Any potential changes cannot take effect until every registered filter acknowledges validation.</p>
<p>Adversaries can register malicious password filters to harvest credentials from local computers and/or entire domains. To perform proper validation, filters must receive plain-text credentials from the LSA. A malicious password filter would receive these plain-text credentials every time a password request is made.(Citation: Carnal Ownage Password Filters Sept 2013)
T1556.001 | Domain Controller Authentication | Adversaries may patch the authentication process on a domain control to bypass the typical authentication mechanisms and enable access to accounts.</p>
<p>Malware may be used to inject false credentials into the authentication process on a domain control with the intent of creating a backdoor used to access any user’s account and/or credentials (ex: <a class="reference external" href="https://attack.mitre.org/software/S0007">Skeleton Key</a>). Skeleton key works through a patch on an enterprise domain controller authentication process (LSASS) with credentials that adversaries may use to bypass the standard authentication system. Once patched, an adversary can use the injected password to successfully authenticate as any domain user account (until the the skeleton key is erased from memory by a reboot of the domain controller). Authenticated access may enable unfettered access to hosts and/or resources within single-factor authentication environments.(Citation: Dell Skeleton)
T1556 | Modify Authentication Process | Adversaries may modify authentication mechanisms and processes to access user credentials or enable otherwise unwarranted access to accounts. The authentication process is handled by mechanisms, such as the Local Security Authentication Server (LSASS) process and the Security Accounts Manager (SAM) on Windows or pluggable authentication modules (PAM) on Unix-based systems, responsible for gathering, storing, and validating credentials.</p>
<p>Adversaries may maliciously modify a part of this process to either reveal credentials or bypass authentication mechanisms. Compromised credentials or access may be used to bypass access controls placed on various resources on systems within the network and may even be used for persistent access to remote systems and externally available services, such as VPNs, Outlook Web Access and remote desktop.
T1056.004 | Credential API Hooking | Adversaries may hook into Windows application programming interface (API) functions to collect user credentials. Malicious hooking mechanisms may capture API calls that include parameters that reveal user authentication credentials.(Citation: Microsoft TrojanSpy:Win32/Ursnif.gen!I Sept 2017) Unlike <a class="reference external" href="https://attack.mitre.org/techniques/T1056/001">Keylogging</a>,  this technique focuses specifically on API functions that include parameters that reveal user credentials. Hooking involves redirecting calls to these functions and can be implemented via:</p>
<ul class="simple">
<li><p><strong>Hooks procedures</strong>, which intercept and execute designated code in response to events such as messages, keystrokes, and mouse inputs.(Citation: Microsoft Hook Overview)(Citation: Endgame Process Injection July 2017)</p></li>
<li><p><strong>Import address table (IAT) hooking</strong>, which use modifications to a process’s IAT, where pointers to imported API functions are stored.(Citation: Endgame Process Injection July 2017)(Citation: Adlice Software IAT Hooks Oct 2014)(Citation: MWRInfoSecurity Dynamic Hooking 2015)</p></li>
<li><p><strong>Inline hooking</strong>, which overwrites the first bytes in an API function to redirect code flow.(Citation: Endgame Process Injection July 2017)(Citation: HighTech Bridge Inline Hooking Sept 2011)(Citation: MWRInfoSecurity Dynamic Hooking 2015)</p></li>
</ul>
<p>T1056.003 | Web Portal Capture | Adversaries may install code on externally facing portals, such as a VPN login page, to capture and transmit credentials of users who attempt to log into the service. For example, a compromised login page may log provided user credentials before logging the user in to the service.</p>
<p>This variation on input capture may be conducted post-compromise using legitimate administrative access as a backup measure to maintain network access through <a class="reference external" href="https://attack.mitre.org/techniques/T1133">External Remote Services</a> and <a class="reference external" href="https://attack.mitre.org/techniques/T1078">Valid Accounts</a> or as part of the initial compromise by exploitation of the externally facing web service.(Citation: Volexity Virtual Private Keylogging)
T1056.002 | GUI Input Capture | Adversaries may mimic common operating system GUI components to prompt users for credentials with a seemingly legitimate prompt. When programs are executed that need additional privileges than are present in the current user context, it is common for the operating system to prompt the user for proper credentials to authorize the elevated privileges for the task (ex: <a class="reference external" href="https://attack.mitre.org/techniques/T1548/002">Bypass User Access Control</a>).</p>
<p>Adversaries may mimic this functionality to prompt users for credentials with a seemingly legitimate prompt for a number of reasons that mimic normal usage, such as a fake installer requiring additional access or a fake malware removal suite.(Citation: OSX Malware Exploits MacKeeper) This type of prompt can be used to collect credentials via various languages such as AppleScript(Citation: LogRhythm Do You Trust Oct 2014)(Citation: OSX Keydnap malware) and PowerShell(Citation: LogRhythm Do You Trust Oct 2014)(Citation: Enigma Phishing for Credentials Jan 2015).
T1056.001 | Keylogging | Adversaries may log user keystrokes to intercept credentials as the user types them. Keylogging is likely to be used to acquire credentials for new access opportunities when <a class="reference external" href="https://attack.mitre.org/techniques/T1003">OS Credential Dumping</a> efforts are not effective, and may require an adversary to intercept keystrokes on a system for a substantial period of time before credentials can be successfully captured.</p>
<p>Keylogging is the most prevalent type of input capture, with many different ways of intercepting keystrokes.(Citation: Adventures of a Keystroke) Some methods include:</p>
<ul class="simple">
<li><p>Hooking API callbacks used for processing keystrokes. Unlike <a class="reference external" href="https://attack.mitre.org/techniques/T1056/004">Credential API Hooking</a>, this focuses solely on API functions intended for processing keystroke data.</p></li>
<li><p>Reading raw keystroke data from the hardware buffer.</p></li>
<li><p>Windows Registry modifications.</p></li>
<li><p>Custom drivers.
T1555 | Credentials from Password Stores | Adversaries may search for common password storage locations to obtain user credentials. Passwords are stored in several places on a system, depending on the operating system or application holding the credentials. There are also specific applications that store passwords to make it easier for users manage and maintain. Once credentials are obtained, they can be used to perform lateral movement and access restricted information.
T1552.005 | Cloud Instance Metadata API | Adversaries may attempt to access the Cloud Instance Metadata API to collect credentials and other sensitive data.</p></li>
</ul>
<p>Most cloud service providers support a Cloud Instance Metadata API which is a service provided to running virtual instances that allows applications to access information about the running virtual instance. Available information generally includes name, security group, and additional metadata including sensitive data such as credentials and UserData scripts that may contain additional secrets. The Instance Metadata API is provided as a convenience to assist in managing applications and is accessible by anyone who can access the instance.(Citation: AWS Instance Metadata API) A cloud metadata API has been used in at least one high profile compromise.(Citation: Krebs Capital One August 2019)</p>
<p>If adversaries have a presence on the running virtual instance, they may query the Instance Metadata API directly to identify credentials that grant access to additional resources. Additionally, attackers may exploit a Server-Side Request Forgery (SSRF) vulnerability in a public facing web proxy that allows the attacker to gain access to the sensitive information via a request to the Instance Metadata API.(Citation: RedLock Instance Metadata API 2018)</p>
<p>The de facto standard across cloud service providers is to host the Instance Metadata API at <code>http[:]//169.254.169.254</code>.</p>
<p>T1003.008 | /etc/passwd and /etc/shadow | Adversaries may attempt to dump the contents of <code>/etc/passwd</code> and <code>/etc/shadow</code> to enable offline password cracking. Most modern Linux operating systems use a combination of <code>/etc/passwd</code> and <code>/etc/shadow</code> to store user account information including password hashes in <code>/etc/shadow</code>. By default, <code>/etc/shadow</code> is only readable by the root user.(Citation: Linux Password and Shadow File Formats)</p>
<p>The Linux utility, unshadow, can be used to combine the two files in a format suited for password cracking utilities such as John the Ripper:(Citation: nixCraft - John the Ripper) <code># /usr/bin/unshadow /etc/passwd /etc/shadow &gt; /tmp/crack.password.db</code></p>
<p>T1003.007 | Proc Filesystem | Adversaries may gather credentials from information stored in the Proc filesystem or <code>/proc</code>. The Proc filesystem on Linux contains a great deal of information regarding the state of the running operating system. Processes running with root privileges can use this facility to scrape live memory of other running programs. If any of these programs store passwords in clear text or password hashes in memory, these values can then be harvested for either usage or brute force attacks, respectively.</p>
<p>This functionality has been implemented in the MimiPenguin(Citation: MimiPenguin GitHub May 2017), an open source tool inspired by Mimikatz. The tool dumps process memory, then harvests passwords and hashes by looking for text strings and regex patterns for how given applications such as Gnome Keyring, sshd, and Apache use memory to store such authentication artifacts.
T1003.006 | DCSync | Adversaries may attempt to access credentials and other sensitive information by abusing a Windows Domain Controller’s application programming interface (API)(Citation: Microsoft DRSR Dec 2017) (Citation: Microsoft GetNCCChanges) (Citation: Samba DRSUAPI) (Citation: Wine API samlib.dll) to simulate the replication process from a remote domain controller using a technique called DCSync.</p>
<p>Members of the Administrators, Domain Admins, and Enterprise Admin groups or computer accounts on the domain controller are able to run DCSync to pull password data(Citation: ADSecurity Mimikatz DCSync) from Active Directory, which may include current and historical hashes of potentially useful accounts such as KRBTGT and Administrators. The hashes can then in turn be used to create a <a class="reference external" href="https://attack.mitre.org/techniques/T1558/001">Golden Ticket</a> for use in <a class="reference external" href="https://attack.mitre.org/techniques/T1550/003">Pass the Ticket</a>(Citation: Harmj0y Mimikatz and DCSync) or change an account’s password as noted in <a class="reference external" href="https://attack.mitre.org/techniques/T1098">Account Manipulation</a>.(Citation: InsiderThreat ChangeNTLM July 2017)</p>
<p>DCSync functionality has been included in the “lsadump” module in <a class="reference external" href="https://attack.mitre.org/software/S0002">Mimikatz</a>.(Citation: GitHub Mimikatz lsadump Module) Lsadump also includes NetSync, which performs DCSync over a legacy replication protocol.(Citation: Microsoft NRPC Dec 2017)
T1558.003 | Kerberoasting | Adversaries may abuse a valid Kerberos ticket-granting ticket (TGT) or sniff network traffic to obtain a ticket-granting service (TGS) ticket that may be vulnerable to <a class="reference external" href="https://attack.mitre.org/techniques/T1110">Brute Force</a>.(Citation: Empire InvokeKerberoast Oct 2016)(Citation: AdSecurity Cracking Kerberos Dec 2015)</p>
<p>Service principal names (SPNs) are used to uniquely identify each instance of a Windows service. To enable authentication, Kerberos requires that SPNs be associated with at least one service logon account (an account specifically tasked with running a service(Citation: Microsoft Detecting Kerberoasting Feb 2018)).(Citation: Microsoft SPN)(Citation: Microsoft SetSPN)(Citation: SANS Attacking Kerberos Nov 2014)(Citation: Harmj0y Kerberoast Nov 2016)</p>
<p>Adversaries possessing a valid Kerberos ticket-granting ticket (TGT) may request one or more Kerberos ticket-granting service (TGS) service tickets for any SPN from a domain controller (DC).(Citation: Empire InvokeKerberoast Oct 2016)(Citation: AdSecurity Cracking Kerberos Dec 2015) Portions of these tickets may be encrypted with the RC4 algorithm, meaning the Kerberos 5 TGS-REP etype 23 hash of the service account associated with the SPN is used as the private key and is thus vulnerable to offline <a class="reference external" href="https://attack.mitre.org/techniques/T1110">Brute Force</a> attacks that may expose plaintext credentials.(Citation: AdSecurity Cracking Kerberos Dec 2015)(Citation: Empire InvokeKerberoast Oct 2016) (Citation: Harmj0y Kerberoast Nov 2016)</p>
<p>This same attack could be executed using service tickets captured from network traffic.(Citation: AdSecurity Cracking Kerberos Dec 2015)</p>
<p>Cracked hashes may enable <a class="reference external" href="https://attack.mitre.org/tactics/TA0003">Persistence</a>, <a class="reference external" href="https://attack.mitre.org/tactics/TA0004">Privilege Escalation</a>, and <a class="reference external" href="https://attack.mitre.org/tactics/TA0008">Lateral Movement</a> via access to <a class="reference external" href="https://attack.mitre.org/techniques/T1078">Valid Accounts</a>.(Citation: SANS Attacking Kerberos Nov 2014)
T1552.006 | Group Policy Preferences | Adversaries may attempt to find unsecured credentials in Group Policy Preferences (GPP). GPP are tools that allow administrators to create domain policies with embedded credentials. These policies allow administrators to set local accounts.(Citation: Microsoft GPP 2016)</p>
<p>These group policies are stored in SYSVOL on a domain controller. This means that any domain user can view the SYSVOL share and decrypt the password (using the AES key that has been made public).(Citation: Microsoft GPP Key)</p>
<p>The following tools and scripts can be used to gather and decrypt the password file from Group Policy Preference XML files:</p>
<ul class="simple">
<li><p>Metasploit’s post exploitation module: <code>post/windows/gather/credentials/gpp</code></p></li>
<li><p>Get-GPPPassword(Citation: Obscuresecurity Get-GPPPassword)</p></li>
<li><p>gpprefdecrypt.py</p></li>
</ul>
<p>On the SYSVOL share, adversaries may use the following command to enumerate potential GPP XML files: <code>dir /s * .xml</code></p>
<p>T1003.003 | NTDS | Adversaries may attempt to access or create a copy of the Active Directory domain database in order to steal credential information, as well as obtain other information about domain members such as devices, users, and access rights. By default, the NTDS file (NTDS.dit) is located in <code>%SystemRoot%\NTDS\Ntds.dit</code> of a domain controller.(Citation: Wikipedia Active Directory)</p>
<p>In addition to looking NTDS files on active Domain Controllers, attackers may search for backups that contain the same or similar information.(Citation: Metcalf 2015)</p>
<p>The following tools and techniques can be used to enumerate the NTDS file and the contents of the entire Active Directory hashes.</p>
<ul class="simple">
<li><p>Volume Shadow Copy</p></li>
<li><p>secretsdump.py</p></li>
<li><p>Using the in-built Windows tool, ntdsutil.exe</p></li>
<li><p>Invoke-NinjaCopy</p></li>
</ul>
<p>T1003.002 | Security Account Manager | Adversaries may attempt to extract credential material from the Security Account Manager (SAM) database either through in-memory techniques or through the Windows Registry where the SAM database is stored. The SAM is a database file that contains local accounts for the host, typically those found with the <code>net user</code> command. Enumerating the SAM database requires SYSTEM level access.</p>
<p>A number of tools can be used to retrieve the SAM file through in-memory techniques:</p>
<ul class="simple">
<li><p>pwdumpx.exe</p></li>
<li><p><a class="reference external" href="https://attack.mitre.org/software/S0008">gsecdump</a></p></li>
<li><p><a class="reference external" href="https://attack.mitre.org/software/S0002">Mimikatz</a></p></li>
<li><p>secretsdump.py</p></li>
</ul>
<p>Alternatively, the SAM can be extracted from the Registry with Reg:</p>
<ul class="simple">
<li><p><code>reg save HKLM\sam sam</code></p></li>
<li><p><code>reg save HKLM\system system</code></p></li>
</ul>
<p>Creddump7 can then be used to process the SAM database locally to retrieve hashes.(Citation: GitHub Creddump7)</p>
<p>Notes:</p>
<ul class="simple">
<li><p>RID 500 account is the local, built-in administrator.</p></li>
<li><p>RID 501 is the guest account.</p></li>
<li><p>User accounts start with a RID of 1,000+.</p></li>
</ul>
<p>T1003.001 | LSASS Memory | Adversaries may attempt to access credential material stored in the process memory of the Local Security Authority Subsystem Service (LSASS). After a user logs on, the system generates and stores a variety of credential materials in LSASS process memory. These credential materials can be harvested by an administrative user or SYSTEM and used to conduct <a class="reference external" href="https://attack.mitre.org/tactics/TA0008">Lateral Movement</a> using <a class="reference external" href="https://attack.mitre.org/techniques/T1550">Use Alternate Authentication Material</a>.</p>
<p>As well as in-memory techniques, the LSASS process memory can be dumped from the target host and analyzed on a local system.</p>
<p>For example, on the target host use procdump:</p>
<ul class="simple">
<li><p><code>procdump -ma lsass.exe lsass_dump</code></p></li>
</ul>
<p>Locally, mimikatz can be run using:</p>
<ul class="simple">
<li><p><code>sekurlsa::Minidump lsassdump.dmp</code></p></li>
<li><p><code>sekurlsa::logonPasswords</code></p></li>
</ul>
<p>Windows Security Support Provider (SSP) DLLs are loaded into LSSAS process at system start. Once loaded into the LSA, SSP DLLs have access to encrypted and plaintext passwords that are stored in Windows, such as any logged-on user’s Domain password or smart card PINs. The SSP configuration is stored in two Registry keys: <code>HKLM\SYSTEM\CurrentControlSet\Control\Lsa\Security Packages</code> and <code>HKLM\SYSTEM\CurrentControlSet\Control\Lsa\OSConfig\Security Packages</code>. An adversary may modify these Registry keys to add new SSPs, which will be loaded the next time the system boots, or when the AddSecurityPackage Windows API function is called.(Citation: Graeber 2014)</p>
<p>The following SSPs can be used to access credentials:</p>
<ul class="simple">
<li><p>Msv: Interactive logons, batch logons, and service logons are done through the MSV authentication package.</p></li>
<li><p>Wdigest: The Digest Authentication protocol is designed for use with Hypertext Transfer Protocol (HTTP) and Simple Authentication Security Layer (SASL) exchanges.(Citation: TechNet Blogs Credential Protection)</p></li>
<li><p>Kerberos: Preferred for mutual client-server domain authentication in Windows 2000 and later.</p></li>
<li><p>CredSSP:  Provides SSO and Network Level Authentication for Remote Desktop Services.(Citation: TechNet Blogs Credential Protection)</p></li>
</ul>
<p>T1110.004 | Credential Stuffing | Adversaries may use credentials obtained from breach dumps of unrelated accounts to gain access to target accounts through credential overlap. Occasionally, large numbers of username and password pairs are dumped online when a website or service is compromised and the user account credentials accessed. The information may be useful to an adversary attempting to compromise accounts by taking advantage of the tendency for users to use the same passwords across personal and business accounts.</p>
<p>Credential stuffing is a risky option because it could cause numerous authentication failures and account lockouts, depending on the organization’s login failure policies.</p>
<p>Typically, management services over commonly used ports are used when stuffing credentials. Commonly targeted services include the following:</p>
<ul class="simple">
<li><p>SSH (22/TCP)</p></li>
<li><p>Telnet (23/TCP)</p></li>
<li><p>FTP (21/TCP)</p></li>
<li><p>NetBIOS / SMB / Samba (139/TCP &amp; 445/TCP)</p></li>
<li><p>LDAP (389/TCP)</p></li>
<li><p>Kerberos (88/TCP)</p></li>
<li><p>RDP / Terminal Services (3389/TCP)</p></li>
<li><p>HTTP/HTTP Management Services (80/TCP &amp; 443/TCP)</p></li>
<li><p>MSSQL (1433/TCP)</p></li>
<li><p>Oracle (1521/TCP)</p></li>
<li><p>MySQL (3306/TCP)</p></li>
<li><p>VNC (5900/TCP)</p></li>
</ul>
<p>In addition to management services, adversaries may “target single sign-on (SSO) and cloud-based applications utilizing federated authentication protocols,” as well as externally facing email applications, such as Office 365.(Citation: US-CERT TA18-068A 2018)
T1110.003 | Password Spraying | Adversaries may use a single or small list of commonly used passwords against many different accounts to attempt to acquire valid account credentials. Password spraying uses one password (e.g. ‘Password01’), or a small list of commonly used passwords, that may match the complexity policy of the domain. Logins are attempted with that password against many different accounts on a network to avoid account lockouts that would normally occur when brute forcing a single account with many passwords. (Citation: BlackHillsInfosec Password Spraying)</p>
<p>Typically, management services over commonly used ports are used when password spraying. Commonly targeted services include the following:</p>
<ul class="simple">
<li><p>SSH (22/TCP)</p></li>
<li><p>Telnet (23/TCP)</p></li>
<li><p>FTP (21/TCP)</p></li>
<li><p>NetBIOS / SMB / Samba (139/TCP &amp; 445/TCP)</p></li>
<li><p>LDAP (389/TCP)</p></li>
<li><p>Kerberos (88/TCP)</p></li>
<li><p>RDP / Terminal Services (3389/TCP)</p></li>
<li><p>HTTP/HTTP Management Services (80/TCP &amp; 443/TCP)</p></li>
<li><p>MSSQL (1433/TCP)</p></li>
<li><p>Oracle (1521/TCP)</p></li>
<li><p>MySQL (3306/TCP)</p></li>
<li><p>VNC (5900/TCP)</p></li>
</ul>
<p>In addition to management services, adversaries may “target single sign-on (SSO) and cloud-based applications utilizing federated authentication protocols,” as well as externally facing email applications, such as Office 365.(Citation: US-CERT TA18-068A 2018)</p>
<p>In default environments, LDAP and Kerberos connection attempts are less likely to trigger events over SMB, which creates Windows “logon failure” event ID 4625.
T1110.002 | Password Cracking | Adversaries may use password cracking to attempt to recover usable credentials, such as plaintext passwords, when credential material such as password hashes are obtained. <a class="reference external" href="https://attack.mitre.org/techniques/T1003">OS Credential Dumping</a> is used to obtain password hashes, this may only get an adversary so far when <a class="reference external" href="https://attack.mitre.org/techniques/T1550/002">Pass the Hash</a> is not an option. Techniques to systematically guess the passwords used to compute hashes are available, or the adversary may use a pre-computed rainbow table to crack hashes. Cracking hashes is usually done on adversary-controlled systems outside of the target network.(Citation: Wikipedia Password cracking) The resulting plaintext password resulting from a successfully cracked hash may be used to log into systems, resources, and services in which the account has access.
T1110.001 | Password Guessing | Adversaries with no prior knowledge of legitimate credentials within the system or environment may guess passwords to attempt access to accounts. Without knowledge of the password for an account, an adversary may opt to systematically guess the password using a repetitive or iterative mechanism. An adversary may guess login credentials without prior knowledge of system or environment passwords during an operation by using a list of common passwords. Password guessing may or may not take into account the target’s policies on password complexity or use policies that may lock accounts out after a number of failed attempts.</p>
<p>Guessing passwords can be a risky option because it could cause numerous authentication failures and account lockouts, depending on the organization’s login failure policies. (Citation: Cylance Cleaver)</p>
<p>Typically, management services over commonly used ports are used when guessing passwords. Commonly targeted services include the following:</p>
<ul class="simple">
<li><p>SSH (22/TCP)</p></li>
<li><p>Telnet (23/TCP)</p></li>
<li><p>FTP (21/TCP)</p></li>
<li><p>NetBIOS / SMB / Samba (139/TCP &amp; 445/TCP)</p></li>
<li><p>LDAP (389/TCP)</p></li>
<li><p>Kerberos (88/TCP)</p></li>
<li><p>RDP / Terminal Services (3389/TCP)</p></li>
<li><p>HTTP/HTTP Management Services (80/TCP &amp; 443/TCP)</p></li>
<li><p>MSSQL (1433/TCP)</p></li>
<li><p>Oracle (1521/TCP)</p></li>
<li><p>MySQL (3306/TCP)</p></li>
<li><p>VNC (5900/TCP)</p></li>
</ul>
<p>In addition to management services, adversaries may “target single sign-on (SSO) and cloud-based applications utilizing federated authentication protocols,” as well as externally facing email applications, such as Office 365.(Citation: US-CERT TA18-068A 2018)</p>
<p>In default environments, LDAP and Kerberos connection attempts are less likely to trigger events over SMB, which creates Windows “logon failure” event ID 4625.
T1552.004 | Private Keys | Adversaries may search for private key certificate files on compromised systems for insecurely stored credentials. Private cryptographic keys and certificates are used for authentication, encryption/decryption, and digital signatures.(Citation: Wikipedia Public Key Crypto) Common key and certificate file extensions include: .key, .pgp, .gpg, .ppk., .p12, .pem, .pfx, .cer, .p7b, .asc.</p>
<p>Adversaries may also look in common key directories, such as <code>~/.ssh</code> for SSH keys on * nix-based systems or <code>C:\Users\(username).ssh\</code> on Windows. These private keys can be used to authenticate to <a class="reference external" href="https://attack.mitre.org/techniques/T1021">Remote Services</a> like SSH or for use in decrypting other collected files such as email.</p>
<p>Adversary tools have been discovered that search compromised systems for file extensions relating to cryptographic keys and certificates.(Citation: Kaspersky Careto)(Citation: Palo Alto Prince of Persia)</p>
<p>Some private keys require a password or passphrase for operation, so an adversary may also use <a class="reference external" href="https://attack.mitre.org/techniques/T1056">Input Capture</a> for keylogging or attempt to <a class="reference external" href="https://attack.mitre.org/techniques/T1110">Brute Force</a> the passphrase off-line.
T1552.003 | Bash History | Adversaries may search the bash command history on compromised systems for insecurely stored credentials. Bash keeps track of the commands users type on the command-line with the “history” utility. Once a user logs out, the history is flushed to the user’s <code>.bash_history</code> file. For each user, this file resides at the same location: <code>~/.bash_history</code>. Typically, this file keeps track of the user’s last 500 commands. Users often type usernames and passwords on the command-line as parameters to programs, which then get saved to this file when they log out. Attackers can abuse this by looking through the file for potential credentials. (Citation: External to DA, the OS X Way)
T1552.002 | Credentials in Registry | Adversaries may search the Registry on compromised systems for insecurely stored credentials. The Windows Registry stores configuration information that can be used by the system or other programs. Adversaries may query the Registry looking for credentials and passwords that have been stored for use by other programs or services. Sometimes these credentials are used for automatic logons.</p>
<p>Example commands to find Registry keys related to password information: (Citation: Pentestlab Stored Credentials)</p>
<ul class="simple">
<li><p>Local Machine Hive: <code>reg query HKLM /f password /t REG_SZ /s</code></p></li>
<li><p>Current User Hive: <code>reg query HKCU /f password /t REG_SZ /s</code>
T1552.001 | Credentials In Files | Adversaries may search local file systems and remote file shares for files containing insecurely stored credentials. These can be files created by users to store their own credentials, shared credential stores for a group of individuals, configuration files containing passwords for a system or service, or source code/binary files containing embedded passwords.</p></li>
</ul>
<p>It is possible to extract passwords from backups or saved virtual machines through <a class="reference external" href="https://attack.mitre.org/techniques/T1003">OS Credential Dumping</a>. (Citation: CG 2014) Passwords may also be obtained from Group Policy Preferences stored on the Windows Domain Controller. (Citation: SRD GPP)</p>
<p>In cloud environments, authenticated user credentials are often stored in local configuration and credential files. In some cases, these files can be copied and reused on another machine or the contents can be read and then used to authenticate without needing to copy any files. (Citation: Specter Ops - Cloud Credential Storage)
T1552 | Unsecured Credentials | Adversaries may search compromised systems to find and obtain insecurely stored credentials. These credentials can be stored and/or misplaced in many locations on a system, including plaintext files (e.g. <a class="reference external" href="https://attack.mitre.org/techniques/T1552/003">Bash History</a>), operating system or application-specific repositories (e.g. <a class="reference external" href="https://attack.mitre.org/techniques/T1552/002">Credentials in Registry</a>), or other specialized files/artifacts (e.g. <a class="reference external" href="https://attack.mitre.org/techniques/T1552/004">Private Keys</a>).
T1539 | Steal Web Session Cookie | An adversary may steal web application or service session cookies and use them to gain access web applications or Internet services as an authenticated user without needing credentials. Web applications and services often use session cookies as an authentication token after a user has authenticated to a website.</p>
<p>Cookies are often valid for an extended period of time, even if the web application is not actively used. Cookies can be found on disk, in the process memory of the browser, and in network traffic to remote systems. Additionally, other applications on the targets machine might store sensitive authentication cookies in memory (e.g. apps which authenticate to cloud services). Session cookies can be used to bypasses some multi-factor authentication protocols.(Citation: Pass The Cookie)</p>
<p>There are several examples of malware targeting cookies from web browsers on the local system.(Citation: Kaspersky TajMahal April 2019)(Citation: Unit 42 Mac Crypto Cookies January 2019) There are also open source frameworks such as Evilginx 2 and Muraena that can gather session cookies through a man-in-the-middle proxy that can be set up by an adversary and used in phishing campaigns.(Citation: Github evilginx2)(Citation: GitHub Mauraena)</p>
<p>After an adversary acquires a valid cookie, they can then perform a <a class="reference external" href="https://attack.mitre.org/techniques/T1506">Web Session Cookie</a> technique to login to the corresponding web application.
T1528 | Steal Application Access Token | Adversaries can steal user application access tokens as a means of acquiring credentials to access remote systems and resources. This can occur through social engineering and typically requires user action to grant access.</p>
<p>Application access tokens are used to make authorized API requests on behalf of a user and are commonly used as a way to access resources in cloud-based applications and software-as-a-service (SaaS).(Citation: Auth0 - Why You Should Always Use Access Tokens to Secure APIs Sept 2019) OAuth is one commonly implemented framework that issues tokens to users for access to systems. An application desiring access to cloud-based services or protected APIs can gain entry using OAuth 2.0 through a variety of authorization protocols. An example commonly-used sequence is Microsoft’s Authorization Code Grant flow.(Citation: Microsoft Identity Platform Protocols May 2019)(Citation: Microsoft - OAuth Code Authorization flow - June 2019) An OAuth access token enables a third-party application to interact with resources containing user data in the ways requested by the application without obtaining user credentials.</p>
<p>Adversaries can leverage OAuth authorization by constructing a malicious application designed to be granted access to resources with the target user’s OAuth token. The adversary will need to complete registration of their application with the authorization server, for example Microsoft Identity Platform using Azure Portal, the Visual Studio IDE, the command-line interface, PowerShell, or REST API calls.(Citation: Microsoft - Azure AD App Registration - May 2019) Then, they can send a link through <a class="reference external" href="https://attack.mitre.org/techniques/T1192">Spearphishing Link</a> to the target user to entice them to grant access to the application. Once the OAuth access token is granted, the application can gain potentially long-term access to features of the user account through <a class="reference external" href="https://attack.mitre.org/techniques/T1527">Application Access Token</a>.(Citation: Microsoft - Azure AD Identity Tokens - Aug 2019)</p>
<p>Adversaries have been seen targeting Gmail, Microsoft Outlook, and Yahoo Mail users.(Citation: Amnesty OAuth Phishing Attacks, August 2019)(Citation: Trend Micro Pawn Storm OAuth 2017)
T1212 | Exploitation for Credential Access | Adversaries may exploit software vulnerabilities in an attempt to collect credentials. Exploitation of a software vulnerability occurs when an adversary takes advantage of a programming error in a program, service, or within the operating system software or kernel itself to execute adversary-controlled code. Credentialing and authentication mechanisms may be targeted for exploitation by adversaries as a means to gain access to useful credentials or circumvent the process to gain access to systems. One example of this is MS14-068, which targets Kerberos and can be used to forge Kerberos tickets using domain user permissions.(Citation: Technet MS14-068)(Citation: ADSecurity Detecting Forged Tickets) Exploitation for credential access may also result in Privilege Escalation depending on the process targeted or credentials obtained.
T1187 | Forced Authentication | Adversaries may gather credential material by invoking or forcing a user to automatically provide authentication information through a mechanism in which they can intercept.</p>
<p>The Server Message Block (SMB) protocol is commonly used in Windows networks for authentication and communication between systems for access to resources and file sharing. When a Windows system attempts to connect to an SMB resource it will automatically attempt to authenticate and send credential information for the current user to the remote system. (Citation: Wikipedia Server Message Block) This behavior is typical in enterprise environments so that users do not need to enter credentials to access network resources.</p>
<p>Web Distributed Authoring and Versioning (WebDAV) is also typically used by Windows systems as a backup protocol when SMB is blocked or fails. WebDAV is an extension of HTTP and will typically operate over TCP ports 80 and 443. (Citation: Didier Stevens WebDAV Traffic) (Citation: Microsoft Managing WebDAV Security)</p>
<p>Adversaries may take advantage of this behavior to gain access to user account hashes through forced SMB/WebDAV authentication. An adversary can send an attachment to a user through spearphishing that contains a resource link to an external server controlled by the adversary (i.e. <a class="reference external" href="https://attack.mitre.org/techniques/T1221">Template Injection</a>), or place a specially crafted file on navigation path for privileged accounts (e.g. .SCF file placed on desktop) or on a publicly accessible share to be accessed by victim(s). When the user’s system accesses the untrusted resource it will attempt authentication and send information, including the user’s hashed credentials, over SMB to the adversary controlled server. (Citation: GitHub Hashjacking) With access to the credential hash, an adversary can perform off-line <a class="reference external" href="https://attack.mitre.org/techniques/T1110">Brute Force</a> cracking to gain access to plaintext credentials. (Citation: Cylance Redirect to SMB)</p>
<p>There are several different ways this can occur. (Citation: Osanda Stealing NetNTLM Hashes) Some specifics from in-the-wild use include:</p>
<ul class="simple">
<li><p>A spearphishing attachment containing a document with a resource that is automatically loaded when the document is opened (i.e. <a class="reference external" href="https://attack.mitre.org/techniques/T1221">Template Injection</a>). The document can include, for example, a request similar to <code>file[:]//[remote address]/Normal.dotm</code> to trigger the SMB request. (Citation: US-CERT APT Energy Oct 2017)</p></li>
<li><p>A modified .LNK or .SCF file with the icon filename pointing to an external reference such as <code>\[remote address]\pic.png</code> that will force the system to load the resource when the icon is rendered to repeatedly gather credentials. (Citation: US-CERT APT Energy Oct 2017)
T1111 | Two-Factor Authentication Interception | Adversaries may target two-factor authentication mechanisms, such as smart cards, to gain access to credentials that can be used to access systems, services, and network resources. Use of two or multi-factor authentication (2FA or MFA) is recommended and provides a higher level of security than user names and passwords alone, but organizations should be aware of techniques that could be used to intercept and bypass these security mechanisms.</p></li>
</ul>
<p>If a smart card is used for two-factor authentication, then a keylogger will need to be used to obtain the password associated with a smart card during normal use. With both an inserted card and access to the smart card password, an adversary can connect to a network resource using the infected system to proxy the authentication with the inserted hardware token. (Citation: Mandiant M Trends 2011)</p>
<p>Adversaries may also employ a keylogger to similarly target other hardware tokens, such as RSA SecurID. Capturing token input (including a user’s personal identification code) may provide temporary access (i.e. replay the one-time passcode until the next value rollover) as well as possibly enabling adversaries to reliably predict future authentication values (given access to both the algorithm and any seed values used to generate appended temporary codes). (Citation: GCN RSA June 2011)</p>
<p>Other methods of 2FA may be intercepted and used by an adversary to authenticate. It is common for one-time codes to be sent via out-of-band communications (email, SMS). If the device and/or service is not secured, then it may be vulnerable to interception. Although primarily focused on by cyber criminals, these authentication mechanisms have been targeted by advanced actors. (Citation: Operation Emmental)
T1110 | Brute Force | Adversaries may use brute force techniques to gain access to accounts when passwords are unknown or when password hashes are obtained. Without knowledge of the password for an account or set of accounts, an adversary may systematically guess the password using a repetitive or iterative mechanism. Brute forcing passwords can take place via interaction with a service that will check the validity of those credentials or offline against previously acquired credential data, such as password hashes.
T1056 | Input Capture | Adversaries may use methods of capturing user input to obtain credentials or collect information. During normal system usage, users often provide credentials to various different locations, such as login pages/portals or system dialog boxes. Input capture mechanisms may be transparent to the user (e.g. <a class="reference external" href="https://attack.mitre.org/techniques/T1056/004">Credential API Hooking</a>) or rely on deceiving the user into providing input into what they believe to be a genuine service (e.g. <a class="reference external" href="https://attack.mitre.org/techniques/T1056/003">Web Portal Capture</a>).
T1040 | Network Sniffing | Adversaries may sniff network traffic to capture information about an environment, including authentication material passed over the network. Network sniffing refers to using the network interface on a system to monitor or capture information sent over a wired or wireless connection. An adversary may place a network interface into promiscuous mode to passively access data in transit over the network, or use span ports to capture a larger amount of data.</p>
<p>Data captured via this technique may include user credentials, especially those sent over an insecure, unencrypted protocol. Techniques for name service resolution poisoning, such as <a class="reference external" href="https://attack.mitre.org/techniques/T1557/001">LLMNR/NBT-NS Poisoning and SMB Relay</a>, can also be used to capture credentials to websites, proxies, and internal systems by redirecting traffic to an adversary.</p>
<p>Network sniffing may also reveal configuration details, such as running services, version numbers, and other network characteristics (e.g. IP addresses, hostnames, VLAN IDs) necessary for subsequent Lateral Movement and/or Defense Evasion activities.
T1003 | OS Credential Dumping | Adversaries may attempt to dump credentials to obtain account login and credential material, normally in the form of a hash or a clear text password, from the operating system and software. Credentials can then be used to perform <a class="reference external" href="https://attack.mitre.org/tactics/TA0008">Lateral Movement</a> and access restricted information.</p>
<p>Several of the tools mentioned in associated sub-techniques may be used by both adversaries and professional security testers. Additional custom tools likely exist as well.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#Invoke-AtomicTest-By can be downloaded from https://github.com/haresudhan/ART-Utils/Invoke-AtomicTest-By</span>
<span class="n">Invoke</span><span class="o">-</span><span class="n">AtomicTest</span><span class="o">-</span><span class="n">By</span> <span class="o">-</span><span class="n">Tactic</span> <span class="n">credential</span><span class="o">-</span><span class="n">access</span>
</pre></div>
</div>
</div>
</div>
<div class="toctree-wrapper compound">
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: ".net-powershell"
        },
        kernelOptions: {
            kernelName: ".net-powershell",
            path: "./tactics"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = '.net-powershell'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="defense-evasion/T1205.html" title="previous page">T1205 - Traffic Signaling</a>
    <a class='right-next' id="next-link" href="credential-access/T1056.001.html" title="next page">T1056.001 - Input Capture: Keylogging</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Hare Sudhan Muthusamy<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    
  </body>
</html>