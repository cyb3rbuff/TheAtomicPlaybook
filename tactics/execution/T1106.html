

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>T1106 - Native API &#8212; The Atomic Playbook</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/sphinx-book-theme.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/mystnb.js"></script>
    <script src="../../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="T1047 - Windows Management Instrumentation" href="T1047.html" />
    <link rel="prev" title="T1053.001 - Scheduled Task/Job: At (Linux)" href="T1053.001.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">The Atomic Playbook</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   Welcome to the Atomic Playbook
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../initial-access.html">
   Initial Access
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="reference internal" href="../execution.html">
   Execution
  </a>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="T1569.002.html">
     T1569.002 - System Services: Service Execution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1072.html">
     T1072 - Software Deployment Tools
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1072.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1204.002.html">
     T1204.002 - User Execution: Malicious Link
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1569.001.html">
     T1569.001 - System Services: Launchctl
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1053.html">
     T1053 - Scheduled Task/Job
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1053.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1129.html">
     T1129 - Shared Modules
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1129.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1175.html">
     T1175 - Component Object Model and Distributed COM
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1559.html">
     T1559 - Inter-Process Communication
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1559.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1153.html">
     T1153 - Source
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1204.001.html">
     T1204.001 - Malicious Link
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1059.003.html">
     T1059.003 - Command and Scripting Interpreter: Windows Command Shell
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1053.004.html">
     T1053.004 - Scheduled Task/Job: Launchd
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1059.html">
     T1059 - Command and Scripting Interpreter
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1059.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1064.html">
     T1064 - Scripting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1059.001.html">
     T1059.001 - Command and Scripting Interpreter: PowerShell
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1059.005.html">
     T1059.005 - Command and Scripting Interpreter: Visual Basic
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1204.html">
     T1204 - User Execution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1204.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1053.002.html">
     T1053.002 - Scheduled Task/Job: At (Windows)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1559.001.html">
     T1559.001 - Component Object Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1059.007.html">
     T1059.007 - JavaScript/JScript
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1569.html">
     T1569 - System Services
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1569.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1059.002.html">
     T1059.002 - Command and Scripting Interpreter: AppleScript
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1053.005.html">
     T1053.005 - Scheduled Task/Job: Scheduled Task
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1203.html">
     T1203 - Exploitation for Client Execution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1203.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1559.002.html">
     T1559.002 - Inter-Process Communication: Dynamic Data Exchange
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1053.001.html">
     T1053.001 - Scheduled Task/Job: At (Linux)
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     T1106 - Native API
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1047.html">
     T1047 - Windows Management Instrumentation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1047.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1059.006.html">
     T1059.006 - Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1059.004.html">
     T1059.004 - Command and Scripting Interpreter: Bash
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1061.html">
     T1061 - Graphical User Interface
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1053.003.html">
     T1053.003 - Scheduled Task/Job: Cron
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../persistence.html">
   Persistence
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../privilege-escalation.html">
   Privilege Escalation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../defense-evasion.html">
   Defense Evasion
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../credential-access.html">
   Credential Access
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../discovery.html">
   Discovery
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../lateral-movement.html">
   Lateral Movement
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../collection.html">
   Collection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../command-and-control.html">
   Command and Control
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../exfiltration.html">
   Exfiltration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../impact.html">
   Impact
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/tactics/execution/T1106.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#atomic-tests">
   Atomic Tests
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#atomic-test-1-execution-through-api-createprocess">
     Atomic Test #1 - Execution through API - CreateProcess
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#attack-commands-run-with-command-prompt">
       Attack Commands: Run with
       <code class="docutils literal notranslate">
        <span class="pre">
         command_prompt
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#detection">
   Detection
  </a>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="t1106-native-api">
<h1>T1106 - Native API<a class="headerlink" href="#t1106-native-api" title="Permalink to this headline">¶</a></h1>
<p>Adversaries may directly interact with the native OS application programming interface (API) to execute behaviors. Native APIs provide a controlled means of calling low-level OS services within the kernel, such as those involving hardware/devices, memory, and processes.(Citation: NT API Windows)(Citation: Linux Kernel API) These native APIs are leveraged by the OS during system boot (when other system components are not yet initialized) as well as carrying out tasks and requests during routine operations.</p>
<p>Functionality provided by native APIs are often also exposed to user-mode applications via interfaces and libraries. For example, functions such as the Windows API <code>CreateProcess()</code> or GNU <code>fork()</code> will allow programs and scripts to start other processes.(Citation: Microsoft CreateProcess)(Citation: GNU Fork) This may allow API callers to execute a binary, run a CLI command, load modules, etc. as thousands of similar API functions exist for various system operations.(Citation: Microsoft Win32)(Citation: LIBC)(Citation: GLIBC)</p>
<p>Higher level software frameworks, such as Microsoft .NET and macOS Cocoa, are also available to interact with native APIs. These frameworks typically provide language wrappers/abstractions to API functionalities and are designed for ease-of-use/portability of code.(Citation: Microsoft NET)(Citation: Apple Core Services)(Citation: MACOS Cocoa)(Citation: macOS Foundation)</p>
<p>Adversaries may abuse these native API functions as a means of executing behaviors. Similar to <a class="reference external" href="https://attack.mitre.org/techniques/T1059">Command and Scripting Interpreter</a>, the native API and its hierarchy of interfaces, provide mechanisms to interact with and utilize various components of a victimized system.</p>
<div class="section" id="atomic-tests">
<h2>Atomic Tests<a class="headerlink" href="#atomic-tests" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#Import the Module before running the tests.</span>
<span class="c1"># Checkout Jupyter Notebook at https://github.com/haresudhan/TheAtomicPlaybook to run PS scripts.</span>
<span class="n">Import</span><span class="o">-</span><span class="n">Module</span> <span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="mh">0x6c</span><span class="o">/</span><span class="n">AtomicRedTeam</span><span class="o">/</span><span class="n">atomics</span><span class="o">/</span><span class="n">invoke</span><span class="o">-</span><span class="n">atomicredteam</span><span class="o">/</span><span class="n">Invoke</span><span class="o">-</span><span class="n">AtomicRedTeam</span><span class="o">.</span><span class="n">psd1</span> <span class="o">-</span> <span class="n">Force</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="atomic-test-1-execution-through-api-createprocess">
<h3>Atomic Test #1 - Execution through API - CreateProcess<a class="headerlink" href="#atomic-test-1-execution-through-api-createprocess" title="Permalink to this headline">¶</a></h3>
<p>Execute program by leveraging Win32 API’s. By default, this will launch calc.exe from the command prompt.
<strong>Supported Platforms:</strong> windows</p>
<div class="section" id="attack-commands-run-with-command-prompt">
<h4>Attack Commands: Run with <code class="docutils literal notranslate"><span class="pre">command_prompt</span></code><a class="headerlink" href="#attack-commands-run-with-command-prompt" title="Permalink to this headline">¶</a></h4>
<div class="highlight-command_prompt notranslate"><div class="highlight"><pre><span></span>C:\Windows\Microsoft.NET\Framework\v4.0.30319\csc.exe /out:&quot;%tmp%\T1106.exe&quot; /target:exe PathToAtomicsFolder\T1106\src\CreateProcess.cs
%tmp/T1106.exe
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">AtomicTest</span> <span class="n">T1106</span> <span class="o">-</span><span class="n">TestNumbers</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="detection">
<h2>Detection<a class="headerlink" href="#detection" title="Permalink to this headline">¶</a></h2>
<p>Monitoring API calls may generate a significant amount of data and may not be useful for defense unless collected under specific circumstances, since benign use of API functions are common and difficult to distinguish from malicious behavior. Correlation of other events with behavior surrounding API function calls using API monitoring will provide additional context to an event that may assist in determining if it is due to malicious behavior. Correlation of activity by process lineage by process ID may be sufficient.</p>
<p>Utilization of the Windows API may involve processes loading/accessing system DLLs associated with providing called functions (ex: kernel32.dll, advapi32.dll, user32.dll, and gdi32.dll). Monitoring for DLL loads, especially to abnormal/unusual or potentially malicious processes, may indicate abuse of the Windows API. Though noisy, this data can be combined with other indicators to identify adversary activity.</p>
</div>
</div>
<div class="section" id="shield-active-defense">
<h1>Shield Active Defense<a class="headerlink" href="#shield-active-defense" title="Permalink to this headline">¶</a></h1>
<div class="section" id="software-manipulation">
<h2>Software Manipulation<a class="headerlink" href="#software-manipulation" title="Permalink to this headline">¶</a></h2>
<p>Make changes to a system’s software properties and functions to achieve a desired effect.</p>
<p>Software Manipulation allows a defender to alter or replace elements of the operating system, file system, or any other software installed and executed on a system.</p>
<div class="section" id="opportunity">
<h3>Opportunity<a class="headerlink" href="#opportunity" title="Permalink to this headline">¶</a></h3>
<p>There is an opportunity for the defender to observe the adversary and control what they can see, what effects they can have, and/or what data they can access.</p>
</div>
<div class="section" id="use-case">
<h3>Use Case<a class="headerlink" href="#use-case" title="Permalink to this headline">¶</a></h3>
<p>A defender can modify system calls to break communications, route things to decoy systems, prevent full execution, etc.</p>
</div>
<div class="section" id="procedures">
<h3>Procedures<a class="headerlink" href="#procedures" title="Permalink to this headline">¶</a></h3>
<p>Hook the Win32 Sleep() function so that it always performs a Sleep(1) instead of the intended duration. This can increase the speed at which dynamic analysis can be performed when a normal malicious file sleeps for long periods before attempting additional capabilities.
Hook the Win32 NetUserChangePassword() and modify it such that the new password is different from the one provided. The data passed into the function is encrypted along with the modified new password, then logged so a defender can get alerted about the change as well as decrypt the new password for use.
Alter the output of an adversary’s profiling commands to make newly-built systems look like the operating system was installed months earlier.
Alter the output of adversary recon commands to not show important assets, such as a file server containing sensitive data.</p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: ".net-powershell"
        },
        kernelOptions: {
            kernelName: ".net-powershell",
            path: "./tactics/execution"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = '.net-powershell'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="T1053.001.html" title="previous page">T1053.001 - Scheduled Task/Job: At (Linux)</a>
    <a class='right-next' id="next-link" href="T1047.html" title="next page">T1047 - Windows Management Instrumentation</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Hare Sudhan Muthusamy<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../../_static/js/index.js"></script>
    
  </body>
</html>