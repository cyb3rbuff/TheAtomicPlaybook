

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Collection &#8212; The Atomic Playbook</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/mystnb.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="T1056.001 - Input Capture: Keylogging" href="collection/T1056.001.html" />
    <link rel="prev" title="T1550 - Use Alternate Authentication Material" href="lateral-movement/T1550.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">The Atomic Playbook</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Welcome to the Atomic Playbook
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="initial-access.html">
   Initial Access
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="execution.html">
   Execution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="persistence.html">
   Persistence
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="privilege-escalation.html">
   Privilege Escalation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="defense-evasion.html">
   Defense Evasion
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="credential-access.html">
   Credential Access
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="discovery.html">
   Discovery
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lateral-movement.html">
   Lateral Movement
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Collection
  </a>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1056.001.html">
     T1056.001 - Input Capture: Keylogging
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1074.html">
     T1074 - Data Staged
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1074.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1113.html">
     T1113 - Screen Capture
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1113.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1056.003.html">
     T1056.003 - Web Portal Capture
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1056.html">
     T1056 - Input Capture
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1056.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1115.html">
     T1115 - Clipboard Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1115.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1213.html">
     T1213 - Data from Information Repositories
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1213.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1056.002.html">
     T1056.002 - Input Capture: GUI Input Capture
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1560.html">
     T1560 - Archive Collected Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1560.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1114.html">
     T1114 - Email Collection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1114.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1056.004.html">
     T1056.004 - Input Capture: Credential API Hooking
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1557.001.html">
     T1557.001 - LLMNR/NBT-NS Poisoning and SMB Relay
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1557.html">
     T1557 - Man-in-the-Middle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1557.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1074.002.html">
     T1074.002 - Remote Data Staging
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1005.html">
     T1005 - Data from Local System
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1005.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1125.html">
     T1125 - Video Capture
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1125.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1530.html">
     T1530 - Data from Cloud Storage Object
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1530.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1114.001.html">
     T1114.001 - Email Collection: Local Email Collection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1025.html">
     T1025 - Data from Removable Media
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1025.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1213.001.html">
     T1213.001 - Confluence
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1123.html">
     T1123 - Audio Capture
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1123.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1114.003.html">
     T1114.003 - Email Forwarding Rule
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1560.002.html">
     T1560.002 - Archive via Library
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1185.html">
     T1185 - Man in the Browser
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1185.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1074.001.html">
     T1074.001 - Data Staged: Local Data Staging
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1039.html">
     T1039 - Data from Network Shared Drive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1039.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1119.html">
     T1119 - Automated Collection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1119.html#shield-active-defense">
     Shield Active Defense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1560.003.html">
     T1560.003 - Archive via Custom Method
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1114.002.html">
     T1114.002 - Remote Email Collection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1560.001.html">
     T1560.001 - Archive Collected Data: Archive via Utility
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collection/T1213.002.html">
     T1213.002 - Sharepoint
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="command-and-control.html">
   Command and Control
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="exfiltration.html">
   Exfiltration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="impact.html">
   Impact
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/tactics/collection.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#techniques">
   Techniques
  </a>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="collection">
<h1>Collection<a class="headerlink" href="#collection" title="Permalink to this headline">¶</a></h1>
<p>The adversary is trying to gather data of interest to their goal.</p>
<p>Collection consists of techniques adversaries may use to gather information and the sources information is collected from that are relevant to following through on the adversary’s objectives. Frequently, the next goal after collecting data is to steal (exfiltrate) the data. Common target sources include various drive types, browsers, audio, video, and email. Common collection methods include capturing screenshots and keyboard input.</p>
<div class="section" id="techniques">
<h2>Techniques<a class="headerlink" href="#techniques" title="Permalink to this headline">¶</a></h2>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>ID</p></th>
<th class="text-align:center head"><p>Name</p></th>
<th class="text-align:center head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>T1074.002</p></td>
<td class="text-align:center"><p>Remote Data Staging</p></td>
<td class="text-align:center"><p>Adversaries may stage data collected from multiple systems in a central location or directory on one system prior to Exfiltration. Data may be kept in separate files or combined into one file through techniques such as <a class="reference external" href="https://attack.mitre.org/techniques/T1560">Archive Collected Data</a>. Interactive command shells may be used, and common functionality within <a class="reference external" href="https://attack.mitre.org/software/S0106">cmd</a> and bash may be used to copy data into a staging location.</p></td>
</tr>
</tbody>
</table>
<p>In cloud environments, adversaries may stage data within a particular instance or virtual machine before exfiltration. An adversary may <a class="reference external" href="https://attack.mitre.org/techniques/T1578/002">Create Cloud Instance</a> and stage data in that instance.(Citation: Mandiant M-Trends 2020)</p>
<p>By staging data on one system prior to Exfiltration, adversaries can minimize the number of connections made to their C2 server and better evade detection.
T1074.001 | Local Data Staging | Adversaries may stage collected data in a central location or directory on the local system prior to Exfiltration. Data may be kept in separate files or combined into one file through techniques such as <a class="reference external" href="https://attack.mitre.org/techniques/T1560">Archive Collected Data</a>. Interactive command shells may be used, and common functionality within <a class="reference external" href="https://attack.mitre.org/software/S0106">cmd</a> and bash may be used to copy data into a staging location.
T1560.003 | Archive via Custom Method | An adversary may compress or encrypt data that is collected prior to exfiltration using a custom method. Adversaries may choose to use custom archival methods, such as encryption with XOR or stream ciphers implemented with no external library or utility references. Custom implementations of well-known compression algorithms have also been used.(Citation: ESET Sednit Part 2)
T1560.002 | Archive via Library | An adversary may compress or encrypt data that is collected prior to exfiltration using 3rd party libraries. Many libraries exist that can archive data, including <a class="reference external" href="https://attack.mitre.org/techniques/T1059/006">Python</a> rarfile (Citation: PyPI RAR), libzip (Citation: libzip), and zlib (Citation: Zlib Github). Most libraries include functionality to encrypt and/or compress data.</p>
<p>Some archival libraries are preinstalled on systems, such as bzip2 on macOS and Linux, and zip on Windows. Note that the libraries are different from the utilities. The libraries can be linked against when compiling, while the utilities require spawning a subshell, or a similar execution mechanism.
T1560.001 | Archive via Utility | An adversary may compress or encrypt data that is collected prior to exfiltration using 3rd party utilities. Many utilities exist that can archive data, including 7-Zip(Citation: 7zip Homepage), WinRAR(Citation: WinRAR Homepage), and WinZip(Citation: WinZip Homepage). Most utilities include functionality to encrypt and/or compress data.</p>
<p>Some 3rd party utilities may be preinstalled, such as <code class="docutils literal notranslate"><span class="pre">tar</span></code> on Linux and macOS or <code class="docutils literal notranslate"><span class="pre">zip</span></code> on Windows systems.
T1560 | Archive Collected Data | An adversary may compress and/or encrypt data that is collected prior to exfiltration. Compressing the data can help to obfuscate the collected data and minimize the amount of data sent over the network. Encryption can be used to hide information that is being exfiltrated from detection or make exfiltration less conspicuous upon inspection by a defender.</p>
<p>Both compression and encryption are done prior to exfiltration, and can be performed using a utility, 3rd party library, or custom method.
T1114.003 | Email Forwarding Rule | Adversaries may setup email forwarding rules to collect sensitive information. Adversaries may abuse email-forwarding rules to monitor the activities of a victim, steal information, and further gain intelligence on the victim or the victim’s organization to use as part of further exploits or operations.(Citation: US-CERT TA18-068A 2018) Outlook and Outlook Web App (OWA) allow users to create inbox rules for various email functions, including forwarding to a different recipient. Messages can be forwarded to internal or external recipients, and there are no restrictions limiting the extent of this rule. Administrators may also create forwarding rules for user accounts with the same considerations and outcomes.(Citation: Microsoft Tim McMichael Exchange Mail Forwarding 2)</p>
<p>Any user or administrator within the organization (or adversary with valid credentials) can create rules to automatically forward all received messages to another recipient, forward emails to different locations based on the sender, and more.
T1114.002 | Remote Email Collection | Adversaries may target an Exchange server or Office 365 to collect sensitive information. Adversaries may leverage a user’s credentials and interact directly with the Exchange server to acquire information from within a network. Adversaries may also access externally facing Exchange services or Office 365 to access email using credentials or access tokens. Tools such as <a class="reference external" href="https://attack.mitre.org/software/S0413">MailSniper</a> can be used to automate searches for specific keywords.
T1114.001 | Local Email Collection | Adversaries may target user email on local systems to collect sensitive information. Files containing email data can be acquired from a user’s local system, such as Outlook storage or cache files.</p>
<p>Outlook stores data locally in offline data files with an extension of .ost. Outlook 2010 and later supports .ost file sizes up to 50GB, while earlier versions of Outlook support up to 20GB.(Citation: Outlook File Sizes) IMAP accounts in Outlook 2013 (and earlier) and POP accounts use Outlook Data Files (.pst) as opposed to .ost, whereas IMAP accounts in Outlook 2016 (and later) use .ost files. Both types of Outlook data files are typically stored in <code class="docutils literal notranslate"><span class="pre">C:\Users\&lt;username&gt;\Documents\Outlook</span> <span class="pre">Files</span></code> or <code class="docutils literal notranslate"><span class="pre">C:\Users\&lt;username&gt;\AppData\Local\Microsoft\Outlook</span></code>.(Citation: Microsoft Outlook Files)
T1213.002 | Sharepoint | Adversaries may leverage the SharePoint repository as a source to mine valuable information. SharePoint will often contain useful information for an adversary to learn about the structure and functionality of the internal network and systems. For example, the following is a list of example information that may hold potential value to an adversary and may also be found on SharePoint:</p>
<ul class="simple">
<li><p>Policies, procedures, and standards</p></li>
<li><p>Physical / logical network diagrams</p></li>
<li><p>System architecture diagrams</p></li>
<li><p>Technical system documentation</p></li>
<li><p>Testing / development credentials</p></li>
<li><p>Work / project schedules</p></li>
<li><p>Source code snippets</p></li>
<li><p>Links to network shares and other internal resources</p></li>
</ul>
<p>T1213.001 | Confluence |
Adversaries may leverage Confluence repositories to mine valuable information. Often found in development environments alongside Atlassian JIRA, Confluence is generally used to store development-related documentation, however, in general may contain more diverse categories of useful information, such as:</p>
<ul class="simple">
<li><p>Policies, procedures, and standards</p></li>
<li><p>Physical / logical network diagrams</p></li>
<li><p>System architecture diagrams</p></li>
<li><p>Technical system documentation</p></li>
<li><p>Testing / development credentials</p></li>
<li><p>Work / project schedules</p></li>
<li><p>Source code snippets</p></li>
<li><p>Links to network shares and other internal resources</p></li>
</ul>
<p>T1557.001 | LLMNR/NBT-NS Poisoning and SMB Relay | By responding to LLMNR/NBT-NS network traffic, adversaries may spoof an authoritative source for name resolution to force communication with an adversary controlled system. This activity may be used to collect or relay authentication materials.</p>
<p>Link-Local Multicast Name Resolution (LLMNR) and NetBIOS Name Service (NBT-NS) are Microsoft Windows components that serve as alternate methods of host identification. LLMNR is based upon the Domain Name System (DNS) format and allows hosts on the same local link to perform name resolution for other hosts. NBT-NS identifies systems on a local network by their NetBIOS name. (Citation: Wikipedia LLMNR) (Citation: TechNet NetBIOS)</p>
<p>Adversaries can spoof an authoritative source for name resolution on a victim network by responding to LLMNR (UDP 5355)/NBT-NS (UDP 137) traffic as if they know the identity of the requested host, effectively poisoning the service so that the victims will communicate with the adversary controlled system. If the requested host belongs to a resource that requires identification/authentication, the username and NTLMv2 hash will then be sent to the adversary controlled system. The adversary can then collect the hash information sent over the wire through tools that monitor the ports for traffic or through <a class="reference external" href="https://attack.mitre.org/techniques/T1040">Network Sniffing</a> and crack the hashes offline through <a class="reference external" href="https://attack.mitre.org/techniques/T1110">Brute Force</a> to obtain the plaintext passwords. In some cases where an adversary has access to a system that is in the authentication path between systems or when automated scans that use credentials attempt to authenticate to an adversary controlled system, the NTLMv2 hashes can be intercepted and relayed to access and execute code against a target system. The relay step can happen in conjunction with poisoning but may also be independent of it. (Citation: byt3bl33d3r NTLM Relaying)(Citation: Secure Ideas SMB Relay)</p>
<p>Several tools exist that can be used to poison name services within local networks such as NBNSpoof, Metasploit, and <a class="reference external" href="https://attack.mitre.org/software/S0174">Responder</a>. (Citation: GitHub NBNSpoof) (Citation: Rapid7 LLMNR Spoofer) (Citation: GitHub Responder)
T1557 | Man-in-the-Middle | Adversaries may attempt to position themselves between two or more networked devices using a man-in-the-middle (MiTM) technique to support follow-on behaviors such as <a class="reference external" href="https://attack.mitre.org/techniques/T1040">Network Sniffing</a> or <a class="reference external" href="https://attack.mitre.org/techniques/T1565/002">Transmitted Data Manipulation</a>. By abusing features of common networking protocols that can determine the flow of network traffic (e.g. ARP, DNS, LLMNR, etc.), adversaries may force a device to communicate through an adversary controlled system so they can collect information or perform additional actions.(Citation: Rapid7 MiTM Basics)</p>
<p>Adversaries may leverage the MiTM position to attempt to modify traffic, such as in <a class="reference external" href="https://attack.mitre.org/techniques/T1565/002">Transmitted Data Manipulation</a>. Adversaries can also stop traffic from flowing to the appropriate destination, causing denial of service.
T1056.004 | Credential API Hooking | Adversaries may hook into Windows application programming interface (API) functions to collect user credentials. Malicious hooking mechanisms may capture API calls that include parameters that reveal user authentication credentials.(Citation: Microsoft TrojanSpy:Win32/Ursnif.gen!I Sept 2017) Unlike <a class="reference external" href="https://attack.mitre.org/techniques/T1056/001">Keylogging</a>,  this technique focuses specifically on API functions that include parameters that reveal user credentials. Hooking involves redirecting calls to these functions and can be implemented via:</p>
<ul class="simple">
<li><p><strong>Hooks procedures</strong>, which intercept and execute designated code in response to events such as messages, keystrokes, and mouse inputs.(Citation: Microsoft Hook Overview)(Citation: Endgame Process Injection July 2017)</p></li>
<li><p><strong>Import address table (IAT) hooking</strong>, which use modifications to a process’s IAT, where pointers to imported API functions are stored.(Citation: Endgame Process Injection July 2017)(Citation: Adlice Software IAT Hooks Oct 2014)(Citation: MWRInfoSecurity Dynamic Hooking 2015)</p></li>
<li><p><strong>Inline hooking</strong>, which overwrites the first bytes in an API function to redirect code flow.(Citation: Endgame Process Injection July 2017)(Citation: HighTech Bridge Inline Hooking Sept 2011)(Citation: MWRInfoSecurity Dynamic Hooking 2015)</p></li>
</ul>
<p>T1056.003 | Web Portal Capture | Adversaries may install code on externally facing portals, such as a VPN login page, to capture and transmit credentials of users who attempt to log into the service. For example, a compromised login page may log provided user credentials before logging the user in to the service.</p>
<p>This variation on input capture may be conducted post-compromise using legitimate administrative access as a backup measure to maintain network access through <a class="reference external" href="https://attack.mitre.org/techniques/T1133">External Remote Services</a> and <a class="reference external" href="https://attack.mitre.org/techniques/T1078">Valid Accounts</a> or as part of the initial compromise by exploitation of the externally facing web service.(Citation: Volexity Virtual Private Keylogging)
T1056.002 | GUI Input Capture | Adversaries may mimic common operating system GUI components to prompt users for credentials with a seemingly legitimate prompt. When programs are executed that need additional privileges than are present in the current user context, it is common for the operating system to prompt the user for proper credentials to authorize the elevated privileges for the task (ex: <a class="reference external" href="https://attack.mitre.org/techniques/T1548/002">Bypass User Access Control</a>).</p>
<p>Adversaries may mimic this functionality to prompt users for credentials with a seemingly legitimate prompt for a number of reasons that mimic normal usage, such as a fake installer requiring additional access or a fake malware removal suite.(Citation: OSX Malware Exploits MacKeeper) This type of prompt can be used to collect credentials via various languages such as AppleScript(Citation: LogRhythm Do You Trust Oct 2014)(Citation: OSX Keydnap malware) and PowerShell(Citation: LogRhythm Do You Trust Oct 2014)(Citation: Enigma Phishing for Credentials Jan 2015).
T1056.001 | Keylogging | Adversaries may log user keystrokes to intercept credentials as the user types them. Keylogging is likely to be used to acquire credentials for new access opportunities when <a class="reference external" href="https://attack.mitre.org/techniques/T1003">OS Credential Dumping</a> efforts are not effective, and may require an adversary to intercept keystrokes on a system for a substantial period of time before credentials can be successfully captured.</p>
<p>Keylogging is the most prevalent type of input capture, with many different ways of intercepting keystrokes.(Citation: Adventures of a Keystroke) Some methods include:</p>
<ul class="simple">
<li><p>Hooking API callbacks used for processing keystrokes. Unlike <a class="reference external" href="https://attack.mitre.org/techniques/T1056/004">Credential API Hooking</a>, this focuses solely on API functions intended for processing keystroke data.</p></li>
<li><p>Reading raw keystroke data from the hardware buffer.</p></li>
<li><p>Windows Registry modifications.</p></li>
<li><p>Custom drivers.
T1530 | Data from Cloud Storage Object | Adversaries may access data objects from improperly secured cloud storage.</p></li>
</ul>
<p>Many cloud service providers offer solutions for online data storage such as Amazon S3, Azure Storage, and Google Cloud Storage. These solutions differ from other storage solutions (such as SQL or Elasticsearch) in that there is no overarching application. Data from these solutions can be retrieved directly using the cloud provider’s APIs. Solution providers typically offer security guides to help end users configure systems.(Citation: Amazon S3 Security, 2019)(Citation: Microsoft Azure Storage Security, 2019)(Citation: Google Cloud Storage Best Practices, 2019)</p>
<p>Misconfiguration by end users is a common problem. There have been numerous incidents where cloud storage has been improperly secured (typically by unintentionally allowing public access by unauthenticated users or overly-broad access by all users), allowing open access to credit cards, personally identifiable information, medical records, and other sensitive information.(Citation: Trend Micro S3 Exposed PII, 2017)(Citation: Wired Magecart S3 Buckets, 2019)(Citation: HIPAA Journal S3 Breach, 2017) Adversaries may also obtain leaked credentials in source repositories, logs, or other means as a way to gain access to cloud storage objects that have access permission controls.
T1213 | Data from Information Repositories | Adversaries may leverage information repositories to mine valuable information. Information repositories are tools that allow for storage of information, typically to facilitate collaboration or information sharing between users, and can store a wide variety of data that may aid adversaries in further objectives, or direct access to the target information.</p>
<p>Adversaries may also collect information from shared storage repositories hosted on cloud infrastructure or in software-as-a-service (SaaS) applications, as storage is one of the more fundamental requirements for cloud services and systems.</p>
<p>The following is a brief list of example information that may hold potential value to an adversary and may also be found on an information repository:</p>
<ul class="simple">
<li><p>Policies, procedures, and standards</p></li>
<li><p>Physical / logical network diagrams</p></li>
<li><p>System architecture diagrams</p></li>
<li><p>Technical system documentation</p></li>
<li><p>Testing / development credentials</p></li>
<li><p>Work / project schedules</p></li>
<li><p>Source code snippets</p></li>
<li><p>Links to network shares and other internal resources</p></li>
</ul>
<p>Information stored in a repository may vary based on the specific instance or environment. Specific common information repositories include <a class="reference external" href="https://attack.mitre.org/techniques/T1213/002">Sharepoint</a>, <a class="reference external" href="https://attack.mitre.org/techniques/T1213/001">Confluence</a>, and enterprise databases such as SQL Server.
T1185 | Man in the Browser | Adversaries can take advantage of security vulnerabilities and inherent functionality in browser software to change content, modify behavior, and intercept information as part of various man in the browser techniques. (Citation: Wikipedia Man in the Browser)</p>
<p>A specific example is when an adversary injects software into a browser that allows an them to inherit cookies, HTTP sessions, and SSL client certificates of a user and use the browser as a way to pivot into an authenticated intranet. (Citation: Cobalt Strike Browser Pivot) (Citation: ICEBRG Chrome Extensions)</p>
<p>Browser pivoting requires the SeDebugPrivilege and a high-integrity process to execute. Browser traffic is pivoted from the adversary’s browser through the user’s browser by setting up an HTTP proxy which will redirect any HTTP and HTTPS traffic. This does not alter the user’s traffic in any way. The proxy connection is severed as soon as the browser is closed. Whichever browser process the proxy is injected into, the adversary assumes the security context of that process. Browsers typically create a new process for each tab that is opened and permissions and certificates are separated accordingly. With these permissions, an adversary could browse to any resource on an intranet that is accessible through the browser and which the browser has sufficient permissions, such as Sharepoint or webmail. Browser pivoting also eliminates the security provided by 2-factor authentication. (Citation: cobaltstrike manual)
T1125 | Video Capture | An adversary can leverage a computer’s peripheral devices (e.g., integrated cameras or webcams) or applications (e.g., video call services) to capture video recordings for the purpose of gathering information. Images may also be captured from devices or applications, potentially in specified intervals, in lieu of video files.</p>
<p>Malware or scripts may be used to interact with the devices through an available API provided by the operating system or an application to capture video or images. Video or image files may be written to disk and exfiltrated later. This technique differs from <a class="reference external" href="https://attack.mitre.org/techniques/T1113">Screen Capture</a> due to use of specific devices or applications for video recording rather than capturing the victim’s screen.</p>
<p>In macOS, there are a few different malware samples that record the user’s webcam such as FruitFly and Proton. (Citation: objective-see 2017 review)
T1123 | Audio Capture | An adversary can leverage a computer’s peripheral devices (e.g., microphones and webcams) or applications (e.g., voice and video call services) to capture audio recordings for the purpose of listening into sensitive conversations to gather information.</p>
<p>Malware or scripts may be used to interact with the devices through an available API provided by the operating system or an application to capture audio. Audio files may be written to disk and exfiltrated later.
T1119 | Automated Collection | Once established within a system or network, an adversary may use automated techniques for collecting internal data. Methods for performing this technique could include use of a <a class="reference external" href="https://attack.mitre.org/techniques/T1059">Command and Scripting Interpreter</a> to search for and copy information fitting set criteria such as file type, location, or name at specific time intervals. This functionality could also be built into remote access tools.</p>
<p>This technique may incorporate use of other techniques such as <a class="reference external" href="https://attack.mitre.org/techniques/T1083">File and Directory Discovery</a> and <a class="reference external" href="https://attack.mitre.org/techniques/T1570">Lateral Tool Transfer</a> to identify and move files.
T1115 | Clipboard Data | Adversaries may collect data stored in the clipboard from users copying information within or between applications.</p>
<p>In Windows, Applications can access clipboard data by using the Windows API.(Citation: MSDN Clipboard) OSX provides a native command, <code>pbpaste</code>, to grab clipboard contents.(Citation: Operating with EmPyre)
T1114 | Email Collection | Adversaries may target user email to collect sensitive information. Emails may contain sensitive data, including trade secrets or personal information, that can prove valuable to adversaries. Adversaries can collect or forward email from mail servers or clients.
T1113 | Screen Capture | Adversaries may attempt to take screen captures of the desktop to gather information over the course of an operation. Screen capturing functionality may be included as a feature of a remote access tool used in post-compromise operations. Taking a screenshot is also typically possible through native utilities or API calls, such as <code>CopyFromScreen</code>, <code>xwd</code>, or <code>screencapture</code>.(Citation: CopyFromScreen .NET)(Citation: Antiquated Mac Malware)</p>
<p>T1074 | Data Staged | Adversaries may stage collected data in a central location or directory prior to Exfiltration. Data may be kept in separate files or combined into one file through techniques such as <a class="reference external" href="https://attack.mitre.org/techniques/T1560">Archive Collected Data</a>. Interactive command shells may be used, and common functionality within <a class="reference external" href="https://attack.mitre.org/software/S0106">cmd</a> and bash may be used to copy data into a staging location.(Citation: PWC Cloud Hopper April 2017)</p>
<p>In cloud environments, adversaries may stage data within a particular instance or virtual machine before exfiltration. An adversary may <a class="reference external" href="https://attack.mitre.org/techniques/T1578/002">Create Cloud Instance</a> and stage data in that instance.(Citation: Mandiant M-Trends 2020)</p>
<p>Adversaries may choose to stage data from a victim network in a centralized location prior to Exfiltration to minimize the number of connections made to their C2 server and better evade detection.
T1056 | Input Capture | Adversaries may use methods of capturing user input to obtain credentials or collect information. During normal system usage, users often provide credentials to various different locations, such as login pages/portals or system dialog boxes. Input capture mechanisms may be transparent to the user (e.g. <a class="reference external" href="https://attack.mitre.org/techniques/T1056/004">Credential API Hooking</a>) or rely on deceiving the user into providing input into what they believe to be a genuine service (e.g. <a class="reference external" href="https://attack.mitre.org/techniques/T1056/003">Web Portal Capture</a>).
T1039 | Data from Network Shared Drive | Adversaries may search network shares on computers they have compromised to find files of interest. Sensitive data can be collected from remote systems via shared network drives (host shared directory, network file server, etc.) that are accessible from the current system prior to Exfiltration. Interactive command shells may be in use, and common functionality within <a class="reference external" href="https://attack.mitre.org/software/S0106">cmd</a> may be used to gather information.
T1025 | Data from Removable Media | Adversaries may search connected removable media on computers they have compromised to find files of interest. Sensitive data can be collected from any removable media (optical disk drive, USB memory, etc.) connected to the compromised system prior to Exfiltration. Interactive command shells may be in use, and common functionality within <a class="reference external" href="https://attack.mitre.org/software/S0106">cmd</a> may be used to gather information.</p>
<p>Some adversaries may also use <a class="reference external" href="https://attack.mitre.org/techniques/T1119">Automated Collection</a> on removable media.
T1005 | Data from Local System | Adversaries may search local system sources, such as file systems or local databases, to find files of interest and sensitive data prior to Exfiltration.</p>
<p>Adversaries may do this using a <a class="reference external" href="https://attack.mitre.org/techniques/T1059">Command and Scripting Interpreter</a>, such as <a class="reference external" href="https://attack.mitre.org/software/S0106">cmd</a>, which has functionality to interact with the file system to gather information. Some adversaries may also use <a class="reference external" href="https://attack.mitre.org/techniques/T1119">Automated Collection</a> on the local system.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#Invoke-AtomicTest-By can be downloaded from https://github.com/haresudhan/ART-Utils/tree/master/Invoke-AtomicTest-By</span>
<span class="n">Invoke</span><span class="o">-</span><span class="n">AtomicTest</span><span class="o">-</span><span class="n">By</span> <span class="o">-</span><span class="n">Tactic</span> <span class="n">collection</span>
</pre></div>
</div>
</div>
</div>
<div class="toctree-wrapper compound">
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: ".net-powershell"
        },
        kernelOptions: {
            kernelName: ".net-powershell",
            path: "./tactics"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = '.net-powershell'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="lateral-movement/T1550.html" title="previous page">T1550 - Use Alternate Authentication Material</a>
    <a class='right-next' id="next-link" href="collection/T1056.001.html" title="next page">T1056.001 - Input Capture: Keylogging</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Hare Sudhan Muthusamy<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    
  </body>
</html>